2005-03-22  Paolo Carlini  <pcarlini@suse.de>

        Merged to mainline at tag libstdcxx_so_7-merge-20050322.

2005-03-22  Christopher Jefferson  <chris@bubblescope.net>

	* include/bits/moveable.h: New.
	* include/Makefile.am: Add.
	* include/Makefile.in: Regenerate.
	* include/bits/stl_algo.h (unique): Make rvalue ref aware.
	* include/bits/stl_vector.h (vector): Add rvalue ref constructor
	and operator=.
	(__gnu_cxx::__is_moveable): Add overload to mark vector<T> as
	rvalue ref aware.
	* testsuite/testsuite_rvalref.h: New.
	* testsuite/23_containers/vector/moveable.cc: New.
	* testsuite/25_algorithms/unique/moveable.cc: New.

2005-03-14  Paolo Carlini  <pcarlini@suse.de>

        Merged to mainline at tag libstdcxx_so_7-merge-20050314.

2005-03-14  Christopher Jefferson  <chris@bubblescope.net>

	* include/bits/stl_algo.h (replace_copy, replace_copy_of):
	Don't assume that __new_value and *__first are convertible to
	each other.	

	* include/bits/stl_algobase.h (min): Readd lost comment.
	* include/bits/predefined_ops.h (equal_to::operator(),
	less::operator()): Add const.
	* testsuite/testsuite_iterators.h (WritableObject::WritableObject):
	Add const.
	* testsuite/25_algorithms/find/1.cc: New.
	* testsuite/25_algorithms/find/check_type.cc: New.
	* testsuite/25_algorithms/find_if/1.cc: New.
	* testsuite/25_algorithms/find_if/check_type.cc: New.
	* testsuite/25_algorithms/replace/1.cc: New.
	* testsuite/25_algorithms/replace/check_type.cc: New.
	* testsuite/25_algorithms/replace_if/1.cc: New.
	* testsuite/25_algorithms/replace_if/check_type.cc: New.
	* testsuite/25_algorithms/replace_copy/1.cc: New.
	* testsuite/25_algorithms/replace_copy/check_type.cc: New.
	* testsuite/25_algorithms/replace_copy_if/1.cc: New.
	* testsuite/25_algorithms/replace_copy_if/check_type.cc: New.
	* testsuite/25_algorithms/remove/1.cc: New.
	* testsuite/25_algorithms/remove/check_type.cc: New.
	* testsuite/25_algorithms/remove_if/1.cc: New.
	* testsuite/25_algorithms/remove_if/check_type.cc: New.
	* testsuite/25_algorithms/count/1.cc: New.
	* testsuite/25_algorithms/count/check_type.cc: New.
	* testsuite/25_algorithms/count_if/1.cc: New.
	* testsuite/25_algorithms/count_if/check_type.cc: New.

2005-02-27  Paolo Carlini  <pcarlini@suse.de>

        Merged to mainline at tag libstdcxx_so_7-merge-20050227.

2005-02-27  Christopher Jefferson  <chris@bubblescope.net>
            Paolo Carlini  <pcarlini@suse.de>

	* include/bits/stl_heap.h (__is_heap, __push_heap, push_heap, 
	pop_heap, make_heap, sort_heap): Make non-predicated version call
	predicated version.
	* include/bits/stl_algobase.h (min, max): Likewise.
	* testsuite/ext/is_heap/check_type.cc : New.

2005-02-27  Paolo Carlini  <pcarlini@suse.de>

	* testsuite/ext/is_heap/1.cc: New.

2005-02-21  Paolo Carlini  <pcarlini@suse.de>

	PR libstdc++/17922 (ABI-unsafe half)
	* config/io/c_io_stdio.h (struct __ios_flags): Remove.
	* include/bits/ios_base.h (enum _Ios_Fmtflags, enum _Ios_Openmode,
	enum _Ios_Iostate, enum _Ios_Seekdir): Remove *_end enumerators.
	(class ios_base): Adjust fmtflags, iostate, openmore, seekdir
	static constants.
	* src/ios.cc: Remove definitions of __ios_flags constants.
	* testsuite/27_io/ios_base/types/fmtflags/case_label.cc: Adjust,
	removing the dummy label.
	* testsuite/27_io/ios_base/types/iostate/case_label.cc: Likewise.
	* testsuite/27_io/ios_base/types/openmode/case_label.cc: Likewise.
	* testsuite/27_io/ios_base/types/seekdir/case_label.cc: Likewise.
	* testsuite/27_io/ios_base/cons/assign_neg.cc: Adjust dg-error
	line numbers.
	* testsuite/27_io/ios_base/cons/copy_neg.cc: Likewise.

2005-02-21  Paolo Carlini  <pcarlini@suse.de>

        Merged to mainline at tag libstdcxx_so_7-merge-20050221.

2005-02-20  Paolo Carlini  <pcarlini@suse.de>

	* include/ext/rc_string.h: Add __rc_string(const __rc_string&);
	restore the _M_data(_CharT*); add _M_length(), _M_capacity(),
	_M_set_length(); minor clean-ups.
	(__rc_string(_CharT*, const _Alloc&), _M_data_pointer): Remove.
	(_M_assign): Tweak to take a const __rc_string&.
	(_M_swap): Tweak to take a __rc_string&.
	(_Rep::_M_is_shared, _M_is_leaked, _M_set_shared, _M_set_leaked):
	Move out to __rc_string.
	* include/bits/basic_string.h: Tweak consistently with the above.
	* include/bits/basic_string.tcc: Likewise.

2005-02-18  Paolo Carlini  <pcarlini@suse.de>

	* acinclude.m4 ([GLIBCXX_ENABLE_STRING]): New, allows to
	configure at build time the memory allocation policy.
	* configure.ac: Use it.
	* config/linker-map.gnu: Add symbols.
	* config/string/rc_string_base.h: New.
	* include/Makefile.am: Add new headers.
	(host_headers_extra): Add c++string.h.
	* include/bits/basic_string.h: Remove the low level memory
	allocation bits, now configurable: basic_string derives 
	from ___glibcxx_base_string, included via c++string.h.
	* include/bits/basic_string.tcc: Likewise use facilities
	provided by the base class.
	* include/ext/rc_string.h: New, __rc_string encapsulates
	a reference-counted memory allocation policy, very similar
	to the traditional one; derives from __string_utility.
	* include/ext/string_util.h: New, class __string_utility
	provides static utility function for moving and copying
	chars.
	* src/rc_string-inst.cc: New, __rc_string instantiations.
	* src/wrc_string-inst.cc: Likewise.
	* src/Makefile.am: Add.
	* src/string-inst.cc: Tweak consistently.
	* Makefile.in: Regenerate
	* configure: Likewise.
	* include/Makefile.in: Likewise.
	* libmath/Makefile.in: Likewise.
	* libsupc++/Makefile.in: Likewise.
	* po/Makefile.in: Likewise.
	* src/Makefile.in: Likewise.
	* testsuite/Makefile.in: Likewise.

2005-02-16  Paolo Carlini  <pcarlini@suse.de>

        Merged to mainline at tag libstdcxx_so_7-merge-20050216.

2005-02-10  Paolo Carlini  <pcarlini@suse.de>

	* testsuite/21_strings/basic_string/capacity/1.c: Tweak, avoid
	the assumption that the capacity of a default constructed string
	is zero.
	* testsuite/21_strings/basic_string/capacity/char/1.cc: Same.
	* testsuite/21_strings/basic_string/capacity/char/18654.cc: Same.
	* testsuite/21_strings/basic_string/capacity/char/2.cc: Same.
	* testsuite/21_strings/basic_string/capacity/wchar_t/1.cc: Same.
	* testsuite/21_strings/basic_string/capacity/wchar_t/18654.cc: Same.
	* testsuite/21_strings/basic_string/capacity/wchar_t/2.cc: Same.

	* testsuite/21_strings/basic_string/swap/char/1.cc: New.
	* testsuite/21_strings/basic_string/swap/wchar_t/1.cc: Same.

2005-02-01  Paolo Carlini  <pcarlini@suse.de>

	* include/bits/stl_algo.h: Minor tweaks (i.e., add missing std::
	qualifications, remove unused typedefs, formatting).

2005-02-01  Paolo Carlini  <pcarlini@suse.de>

        Merged to mainline at tag libstdcxx_so_7-merge-20050201.

2005-02-01  Christopher Jefferson  <chris@bubblescope.net>

	* include/bits/stl_algo.h (__median, adjacent_find, search, search_n,
	unique, unique_copy, partial_sort, partial_sort_copy, sort, 
	lower_bound, merge, inplace_merge, stable_sort, nth_element, 
	equal_range, binary_search, includes, set_union, set_intersection,
	set_difference, set_symmetric_difference, min_element, max_element,
	next_permutation, prev_permutation, find_first_of, find_end): 
	Make non-predicated version call predicated version.

2005-02-01  Christopher Jefferson  <chris@bubblescope.net>

	* testsuite/testsuite_iterators.h (random_access_iterator_wrapper::
	operator--) : Fix typo.
	(OutputContainer::OutputContainer) : Correct zeroing array.
	(WritableObject::operator==) : Fix typo.
        (WritableObject::operator=) : make operator= templated 
	to allow differing types to be assigned.
	(WritableObject::operator++) : Fix checking if iterator is
	written to multiple times.
	(random_access_iterator_wrapper::operator+) : Add const.
	(random_access_iterator_wrapper::operator-) : Likewise.
	(random_access_iterator_wrapper::operator[]) : Add dereference.
	* testsuite/ext/median.cc: New.
	* testsuite/25_algorithms/adjacent_find/1.cc: New.
	* testsuite/25_algorithms/adjacent_find/check_type.cc: New.
	* testsuite/25_algorithms/search/1.cc: New.
	* testsuite/25_algorithms/search/check_type.cc: New.
	* testsuite/25_algorithms/unique_copy/1.cc: New.
	* testsuite/25_algorithms/unique_copy/check_type.cc: New.
	* testsuite/25_algorithms/partial_sort/1.cc: New.
	* testsuite/25_algorithms/partial_sort/check_type.cc: New.
	* testsuite/25_algorithms/partial_sort_copy/1.cc: New.
	* testsuite/25_algorithms/partial_sort_copy/check_type.cc: New.
	* testsuite/25_algorithms/lower_bound/1.cc: New.
	* testsuite/25_algorithms/lower_bound/check_type.cc: New.
	* testsuite/25_algorithms/upper_bound/1.cc: New.
	* testsuite/25_algorithms/upper_bound/check_type.cc: New.
	* testsuite/25_algorithms/merge/1.cc: New.
	* testsuite/25_algorithms/merge/check_type.cc: New.
	* testsuite/25_algorithms/inplace_merge/1.cc: New.
	* testsuite/25_algorithms/inplace_merge/check_type.cc: New.
	* testsuite/25_algorithms/stable_sort/1.cc: New.
	* testsuite/25_algorithms/stable_sort/check_type.cc: New.
	* testsuite/25_algorithms/nth_element/1.cc: New.
	* testsuite/25_algorithms/nth_element/check_type.cc: New.
	* testsuite/25_algorithms/equal_range/1.cc: New.
	* testsuite/25_algorithms/equal_range/check_type.cc: New.
	* testsuite/25_algorithms/binary_search/1.cc: New.
	* testsuite/25_algorithms/binary_search/check_type.cc: New.
	* testsuite/25_algorithms/includes/1.cc: New.
	* testsuite/25_algorithms/includes/check_type.cc: New.
	* testsuite/25_algorithms/set_union/1.cc: New.
	* testsuite/25_algorithms/set_union/check_type.cc: New.
	* testsuite/25_algorithms/set_intersection/1.cc: New.
	* testsuite/25_algorithms/set_intersection/check_type.cc: New.
	* testsuite/25_algorithms/set_difference/1.cc: New.
	* testsuite/25_algorithms/set_difference/check_type.cc: New.
	* testsuite/25_algorithms/set_symmetric_difference/1.cc: New.
	* testsuite/25_algorithms/set_symmetric_difference/check_type.cc: New.	
	* testsuite/25_algorithms/min_element/1.cc: New.
	* testsuite/25_algorithms/min_element/check_type.cc: New.
	* testsuite/25_algorithms/max_element/1.cc: New.
	* testsuite/25_algorithms/max_element/check_type.cc: New.
	* testsuite/25_algorithms/prev_permutation/1.cc: New.
	* testsuite/25_algorithms/prev_permutation/check_type.cc: New.
	* testsuite/25_algorithms/next_permutation/1.cc: New.
	* testsuite/25_algorithms/next_permutation/check_type.cc: New.
	* testsuite/25_algorithms/find_first_of/1.cc: New.
	* testsuite/25_algorithms/find_first_of/check_type.cc: New.
	* testsuite/25_algorithms/find_end/1.cc: New.
	* testsuite/25_algorithms/find_end/check_type.cc: New.
	* testsuite/25_algorithms/equal/check_type.cc: Insert iterator type.
	* testsuite/25_algorithms/lexicographical_compare/check_type.cc:
	Likewise.

2005-01-30  Paolo Carlini  <pcarlini@suse.de>

        Merged to mainline at tag libstdcxx_so_7-merge-20050130.

2005-01-25  Loren J. Rittle  <ljrittle@acm.org>

	* include/bits/locale_facets.h (ctype<wchar_t>::_M_bit):
	Base size on bits in __wmask_type.
	(ctype<wchar_t>::_M_wmask): Likewise.
	* config/locale/generic/ctype_members.cc: Remove magic numbers.

2005-01-24  Paolo Carlini  <pcarlini@suse.de>

        Merged to mainline at tag libstdcxx_so_7-merge-20050124.

2005-01-18  Paolo Carlini  <pcarlini@suse.de>

        Merged to mainline at tag libstdcxx_so_7-merge-20050118.

2005-01-12  Christopher Jefferson <chris@bubblescope.net>

	* include/bits/stl_function.h (mem_fun_t, const_mem_fun_t,
	mem_fun_ref_t, const_mem_fun_ref_t, mem_fun1_t, const_mem_fun1_t,
	mem_fun1_ref_t, const_mem_fun1_ref_t): Remove overloads for void
	return type, just an old HP/SGI workaround.
	* testsuite/20_util/functional/binders.cc: Move to...
	* testsuite/20_util/functional/binders/3113.cc: ...here.
	* testsuite/20_util/functional/binders/1.cc: New.

2005-01-10  Paolo Carlini  <pcarlini@suse.de>

	* include/bits/stl_algobase.h (lexicographical_compare):
	Fix concept check.

2005-01-10  Christopher Jefferson <chris@bubblescope.net>

	* include/bits/predefined_ops.h: New.
	* include/Makefile.am: Add.
	* include/Makefile.in: Regenerate.
	* include/bits/stl_algobase.h (mismatch, equal,
	lexicographical_compare): Make non-predicate version call predicated
	version.
	* testsuite/25_algorithms/lexicographical_compare/check_type.cc: New.
	* testsuite/25_algorithms/lexicographical_compare/1.cc: Likewise.
	* testsuite/25_algorithms/mismatch/check_type.cc: Likewise.
	* testsuite/25_algorithms/mismatch/1.cc: Likewise.
	* testsuite/25_algorithms/equal/check_type.cc: New.
	* testsuite/25_algorithms/equal/1.cc: New.

2005-01-09  Paolo Carlini  <pcarlini@suse.de>

        Merged to mainline at tag libstdcxx_so_7-merge-20050109.

2004-12-31  Paolo Carlini  <pcarlini@suse.de>

        Merged to mainline at tag libstdcxx_so_7-merge-20041231.

2004-12-06  Paolo Carlini  <pcarlini@suse.de>

        Merged to mainline at tag libstdcxx_so_7-merge-20041206.

2004-11-17  Paolo Carlini  <pcarlini@suse.de>

	DR 434. bitset::to_string() hard to use [Ready]
	* include/std/std_bitset.h (to_string): Add three overloads, taking
	fewer template arguments.
	* docs/html/ext/howto.html: Add an entry for DR 434.
	* testsuite/23_containers/bitset/to_string/1.cc: New.

2004-11-16  Paolo Carlini  <pcarlini@suse.de>

        Merged to mainline at tag libstdcxx_so_7-merge-20041116.

2004-11-08  Paolo Carlini  <pcarlini@suse.de>

        Merged to mainline at tag libstdcxx_so_7-merge-20041108.

2004-10-28  Chris Jefferson  <chris@bubblescope.net>

	PR libstdc++/17441
	* include/bit/stl_algo.h (find(,,,input_iterator_tag),
	find(,,,random_access_interator_tag),
	find_if(,,,input_iterator_tag),
	find_if(,,,random_access_iterator_tag)): Uglify function name.
	(find, find_if): Use new uglified specialisation names.
	* testsuite/25_algorithms/find/17441.cc: New.

2004-10-25  Paolo Carlini  <pcarlini@suse.de>

        Merged to mainline at tag libstdcxx_so_7-merge-20041025.

2004-10-18  Paolo Carlini  <pcarlini@suse.de>

        Merged to mainline at tag libstdcxx_so_7-merge-20041018.

2004-10-10  Paolo Carlini  <pcarlini@suse.de>

        Merged to mainline at tag libstdcxx_so_7-merge-20041010.

2004-10-08  Paolo Carlini  <pcarlini@suse.de>

	* include/bits/stl_map.h (map::map(const _Compare&,
	const allocator_type&), map::map(_InputIterator, _InputIterator,
	const _Compare&, const allocator_type&)): Implement according to
	the letter of the standard, i.e., don't use two overloads.
	* include/bits/stl_multimap.h: Likewise for multimap.
	* include/bits/stl_multiset.h: Likewise for multiset.
	* include/bits/stl_set.h: Likewise for set.

	* include/bits/stl_bvector.h (vector::vector(size_type, bool,
	const allocator_type&)): Don't use two overloads; fix the
	signature, the second argument is by const ref.

	* include/bits/stl_bvector.h (assign(size_t, bool)): Fix the
	signature: according to the standard the second argument is by
	const ref.
	(insert(iterator, bool)): Likewise.
	(insert(iterator, size_type, bool)): Likewise for the third arg.

2004-10-03  Paolo Carlini  <pcarlini@suse.de>

        Merged to mainline at tag libstdcxx_so_7-merge-20041003.

2004-09-24  Paolo Carlini  <pcarlini@suse.de>

        Merged to mainline at tag libstdcxx_so_7-merge-20040924.

2004-09-24  Paolo Carlini  <pcarlini@suse.de>
	    Jonathan Wakely  <redi@gcc.gnu.org>

	* include/bits/stl_list.h (list::list(size_type, value_type,
	const allocator_type&): Implement according to the letter of the
	standard, i.e., don't use two overloads, not equivalent in case
	of non default constructible T.
	(list::resize(size_type, const value_type&)): Fix the signature:
	according to the standard the second argument is by value; also,
	don't use two overloads.
	* include/bits/list.tcc (list::resize(size_type, const value_type&)):
	Adjust consistently the signature.
	* include/bits/stl_deque.h (deque::deque(size_type, value_type,
	const allocator_type&)): Likewise.
	(deque::resize(size_type, const value_type&)): Likewise.
	* include/bits/stl_vector.h (vector::vector(size_type, value_type,
	const allocator_type&)): Likewise.
	(vector::resize(size_type, const value_type&)): Likewise.
	* testsuite/testsuite_hooks.h: Add NonDefaultConstructible test type.
	* testsuite/23_containers/deque/explicit_instantiation.cc: Move to...
	* testsuite/23_containers/deque/explicit_instantiation/1.cc: ...here.
	* testsuite/23_containers/deque/explicit_instantiation/2.cc: New.
	* testsuite/23_containers/list/explicit_instantiation.cc: Move to...
	* testsuite/23_containers/list/explicit_instantiation/1.cc: ...here.
	* testsuite/23_containers/list/explicit_instantiation/2.cc: New.
	* testsuite/23_containers/map/explicit_instantiation.cc: Move to...
	* testsuite/23_containers/map/explicit_instantiation/1.cc: ...here.
	* testsuite/23_containers/map/explicit_instantiation/2.cc: New.
	* testsuite/23_containers/multimap/explicit_instantiation.cc: Move to...
	* testsuite/23_containers/multimap/explicit_instantiation/1.cc: ...here.
	* testsuite/23_containers/multimap/explicit_instantiation/2.cc: New.
	* testsuite/23_containers/multiset/explicit_instantiation.cc: Move to...
	* testsuite/23_containers/multiset/explicit_instantiation/1.cc: ...here.
	* testsuite/23_containers/multiset/explicit_instantiation/2.cc: New.
	* testsuite/23_containers/set/explicit_instantiation.cc: Move to...
	* testsuite/23_containers/set/explicit_instantiation/1.cc: ...here.
	* testsuite/23_containers/set/explicit_instantiation/2.cc: New.
	* testsuite/23_containers/vector/explicit_instantiation.cc: Move to...
	* testsuite/23_containers/vector/explicit_instantiation/1.cc: ...here.
	* testsuite/23_containers/vector/explicit_instantiation/2.cc: New.

2004-09-16  Paolo Carlini  <pcarlini@suse.de>

        Merged to mainline at tag libstdcxx_so_7-merge-20040916.

2004-08-30  Paolo Carlini  <pcarlini@suse.de>

        Merged to mainline at tag libstdcxx_so_7-merge-20040830.

2004-08-24  Paolo Carlini  <pcarlini@suse.de>

	PR libstdc++/16896
	* include/bits/stl_list.h (struct _List_node_base): Rename the
	transfer member to _M_transfer, hook to _M_hook, and unhook to
	_M_unhook.
	* include/bits/list.tcc (list<>::insert): Tweak consistently.
	* src/list.cc: Change consistently.
	* config/linker-map.gnu: Likewise.	
	* testsuite/23_containers/list/16896.cc: New.

	* include/bits/stl_list.h: Trivial formatting fixes.

	* config/linker-map.gnu: Move everything in GLIBCXX_3.4, 3.4.1
	and 3.4.2 under GLIBCXX_3.6.
	* testsuite/testsuite_abi.cc: Add GLIBCXX_3.6.
	* configure.ac (libtool_VERSION): Bump to 7:0:0.
	* configure: Regenerate.

2004-08-24  Paolo Carlini  <pcarlini@suse.de>

        Merged to mainline at tag libstdcxx_so_7-merge-20040824.

2004-08-19  Dhruv Matani  <dhruvbird@gmx.net>
	
	* include/bits/stl_tree.h (struct _Rb_tree_impl): Change the
	_M_key_compare member to a function, so that the _M_impl's member
	can be accessed with equal ease for either the normal version, or
	the specialization for PODs - this reduces the size of the red-black
	tree by 4-bytes for optimizable struct comparators; tweak consistently
	all users.

2004-08-17  Paolo Carlini  <pcarlini@suse.de>

        Merged to mainline at tag libstdcxx_so_7-merge-20040817.
