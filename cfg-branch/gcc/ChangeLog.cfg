Thu May  9 14:12:35 CEST 2002  Jan Hubicka  <jh@suse.cz>

	* cfganal.c (can_fallthru): Fix fast path.
	* cfgrtl.c (verify_flow_info): Avoid crash on conditionals
	with edges to the next block.

Tue May  7 15:35:58 CEST 2002  Jan Hubicka  <jh@suse.cz>

	* cfglayout.c (fixup_fallthru_exit_predecessor): Kill.
	(fixup_reorder_chain): properly handle edges to exit block.

Mon May  6 18:14:59 CEST 2002  Jan Hubicka  <jh@suse.cz>

	* params.def (PARAM_MAX_UNROLL_TIMES): set to 8
	* unroll-new.c (unroll_or_peel_loop): Disable peeling when number
	of iterations is unknown.

Mon May  6 15:40:05 CEST 2002  Zdenek Dvorak

	* unroll-new.c (unroll_loop_runtime_iterations): Fix updating
	dominators.

Sun May  5 14:50:49 CEST 2002  Zdenek Dvorak

	* loop.h (struct loop_desc): lim_n and init_n removed, niter added.
	* unroll-new.c (simple_exit): Removed.
	(simple_loop_exit_p, constant_iterations): New.
	(simple_loop_p): Modified to handle loops with more than one exit.
	(peel_loop_completely, unroll_loop_constant_iterations,
	unroll_or_peel_loop): Use desc->niter instead of computing it again.

Sun May  5 13:43:26 CEST 2002  Jan Hubicka  <jh@suse.cz>

	* unroll-new.c (simple_increment, simple_loop_p, test_for_iteration):
	Use stride.
	(count_loop_iterations): Update to handle arbitary strides.
	* loop.h (loop_desc): Use stride, instead of grow.

Sat May  4 21:52:16 CEST 2002  Jan Hubicka  <jh@suse.cz>

	* unroll-new.c (unroll_or_peel_loop): Peel niter+1
	* cfgloopanal.c (create_preheader): Fix updating of profile.

Sat May  4 13:19:39 CEST 2002  Jan Hubicka  <jh@suse.cz>

	* i386.c (TARGET_SCHED_USE_DFA_PIPELINE_INTERFACE): Define
	(ix86_use_dfa_pipeline_interface): New function.
	(ix86_adjust_cost): Simplify handling of AMD Athlon chip.
	* i386.md: Rewrite athlon scheduling description into
	DFA form.

Sat May  4 00:28:09 CEST 2002  Zdenek Dvorak

	* loop-new.c (remove_exit_edges): Removed.
	(record_exit_edges): New.
	(remove_path): Fix.
	(unswitch_loop): Modified for new interface to
	duplicate_loop_to_header_edge.
	(duplicate_loop_to_header_edge): Removed possibility to remove exit
	edges, allow to record them now instead. Minor cleanup.
	* loop.h (duplicate_loop_to_header_edge): Declaration changed.
	* unroll-new.c (peel_loop_completely, unroll_or_peel_loop): Fix
	paradoxical loop handling.
	(unroll_loop_constant_iterations, unroll_loop_runtime_iterations,
	peel_loop_simple, unroll_loop_stupid): Modified for new interface
	to duplicate_loop_to_header_edge.

Thu May  2 19:48:01 CEST 2002  Jan Hubicka  <jh@suse.cz>

	* unroll-new.c (count_loop_iterations): Rewrite.
	(test_for_iteration): New function.
	(variable_initial_value): Verify that the value survives to
	the entry point of the loop.
	(peel_loop_completely, unroll_loop_constant_iterations,
	unroll_loop_runtime_iterations, unroll_or_peel_loop): Update
	for new count_loop_iterations.

Wed May  1 22:34:52 CEST 2002  Jan Hubicka  <jh@suse.cz>

	* Mainline merge (cfg-merge-20023004 tag

Wed May  1 22:36:35 CEST 2002  Zdenek Dvorak

	* basic_block.h (cancel_loop, cancel_loop_tree): Declare.
	(iterate_fix_dominators): Declaration changed.
	* cfgloop.c (flow_loop_free): New static function.
	(flow_loops_dump, flow_loops_free, verify_loop_structure): Modified
	to be able to handle removed loops.
	(flow_loop_tree_node_remove): Modified.
	(cancel_loop, cancel_loop_tree): New functions.
	* loop-new.c (iterate_fix_dominators): Fixed.
	(remove_path): Removed.
	(try_remove_path): Reworked and renamed to remove_path.
	(find_branch, fix_loop_placement): Modified.
	(fix_loop_placements): New.
	(unswitch_loops): Handle possibility of removing loops.
	(unswitch_single_loop): Use reworked remove_path.
	(loopify, unswitch_loops): Reworked.
	* loop.h (struct loop_desc): New fields out_edge and in_edge.
	(remove_path): Declare.
	* unroll-new.c (simple_condition_p): Fix.
	(simple_loop_p): Fill in out_edge and in_edge fields.
	(peel_loop_completely): Really remove the loop.

Tue Apr 30 18:15:50 CEST 2002  Jan Hubicka  <jh@suse.cz>

	* unroll-new.c: Fix types, some formating tweeks.

Fri Apr 26 09:33:58 CEST 2002  Jan Hubicka  <jh@suse.cz>

	* unroll-new.c (count_loop_iterations): Make parameter HOST_WIDE_INT.

Wed Apr 24 17:22:43 CEST 2002  Jan Hubicka  <jh@suse.cz>

	* Merge from mainline  (cfg-merge-20022404 tag)

Tue Apr 23 18:31:36 CEST 2002  Pavel Nejedly  <bim@atrey.karlin.mff.cuni.cz>

	* final.c (end_final): Use C trees to output data structures for profiling.

Tue Apr 23 18:20:20 CEST 2002  Zdenek Dvorak

	* loop.h (unroll_loops, peel_loops): Declaration removed.
	(unroll_and_peel_loops): Declare.
	(struct loop_desc): Type of const_iter changed.
	* params.def (PARAM_MAX_UNROLL_TIMES): New value (due to changed
	semantics).
	* toplev.c (rest_of_compilation): Use unroll_and_peel_loops.
	* unroll-new.c (unroll_loop_new): Removed.
	(peel_loop): Renamed to peel_loop_simple.
	(peel_loop_completely, unroll_loop_stupid, unroll_or_peel_loop,
	unroll_and_peel_loops): New.
	(simple_condition_p): Exclude unsigned cases.
	(count_loop_iterations): Modified.
	(unroll_loop_constant_iterations, unroll_loop_runtime_iterations):
	Modified.

Sun Apr 21 23:02:28 CEST 2002  Jan Hubicka  <jh@suse.cz>

	* predict.c (real_zero, real_one, real_almost_one, real_br_prob_base,
	real_one_half, real_bb_freq_max): New static variables.
	(debug_profile_bbauxs): Kill.
	(process_note_predictions): Kill unused variable.
	(block_info_def, edge_info_def): Use REAL_VALUE_TYPE instead of
	volatile double.
	(propagate_freq): Use REAL_ARITHMETICS.
	(estimate_bb_frequencies): Likevise; init new static variables.

Sat Apr 20 14:18:37 CEST 2002  Jan Hubicka  <jh@suse.cz>

	* toplev.c (flag_trace_scheduling): New static variable
	(lang_independent_options): add -fschedule-traces
	(rest_of_compilation): Avoid crossjumping before sched2
	when scheduling traces;
	(parse_options_and_default_flags): Enable trace scheduling at -O2.
	(process_options):  WHen trace scheduling is enabled, enable
	superblock scheduling and tracer.
	When superblock scheudling, enable schedule_insns2 pass.

Sat Apr 20 10:50:07 CEST 2002  Josef Zlomek <zlomek@matfyz.cz>

	* var-tracking.c (variable_htab_hash): Added const to type.
	(variable_htab_eq): Added const to types.
	(var_tracking_emit_notes): Emit notes before bb->head.
	* ggc-common.c (ggc_mark_rtx_children): Add 'break;' to
	case NOTE_INSN_VAR_LOCATION.

Sat Apr 20 00:36:00 CEST 2002  Jan Hubicka  <jh@suse.cz>

	* basic-block.h (inside_basic_block_p, control_flow_insn_p): Declare.
	* cfgbuild.c (inside_basic_block_p, control_flow_insn_p): Make global.
	* haifa-sched.c (unlink_other_notes): Delete NOTE_INSN_BASIC_BLOCK.
	* sched-ebb.c (scheudle_ebb): Fix CFG, return last update BB.
	(fix_basic_block_boudaries, add_missing_bbs): New.
	(schedule_ebbs): Verify flow info, use CFG.
	* toplev.c (flag_superblock_scheduling): New.
	(lang_independent_options): Add schedule-superblocks
	(rest_of_compilation): Use schedule_ebbs when asked to do so.

Thu Apr 18 12:40:12 CEST 2002  Josef Zlomek <zlomek@matfyz.cz>

	* rtl.h (NOTE_VAR_LOCATION_DECL): Fix indentation.
	(NOTE_VAR_LOCATION_LOC): Fix indentation.
	* print-rtl.c (print_rtx): Fix indentation.
	* var-tracking.c: Fix indentation.

Tue Apr 16 18:03:35 CEST 2002  Jan Hubicka  <jh@suse.cz>

	* Mainline merge (cfg-merge-20021404 tag)

Fri Apr 12 22:43:01 CEST 2002  Josef Zlomek <zlomek@matfyz.cz>

	* bb-reorder.c (find_traces_1_round): Check whether we can copy block.

Wed Apr 10 13:32:28 CEST 2002  Jan Hubicka  <jh@suse.cz>

	* bb-reorder.c (find_traces_1_round): Verify that we can duplicate header.

Tue Apr  9 13:28:24 CEST 2002  Jan Hubicka  <jh@suse.cz>

	* toplev.c (rest_of_compilation): Better debug output; allways run webizer2
	* unroll-new.c (unroll_loop_runtime_iterations): Limit urolling to expected number
	of iterations.
	(peel_loop): Avoid check to bypass peeling on simple loops.

Tue Apr  9 12:21:55 CEST 2002  Jan Hubicka  <jh@suse.cz>

	* cfgloop.c (expected_loop_iterations): Compute the upper bound.

Sun Apr  7 18:22:35 CEST 2002  Josef Zlomek <zlomek@matfyz.cz>

	* bb-reorder.c (find_traces): Fix connecting traces.

Sun Apr  7 17:57:11 CEST 2002  Zdenek Dvorak

	* basic-block.h (loop_preheader_edge, loop_latch_edge): Declare.
	* cfgloop.c (loop_preheader_edge, loop_latch_edge): New.
	* loop-new.c (duplicate_loop_to_header_edge): Use them.
	* unroll-new.c (variable_initial_value, peel_loop, unroll_loop_new):
	Use them.
	(unroll_loop_runtime_iterations, unroll_loop_constant_iterations):
	Modified to produce more sequential code.

Sat Apr  6 20:55:09 CEST 2002  Jan Hubicka  <jh@suse.cz>

	* cfgrtl.c (flow_delete_block): Do not miss basic block boundaries.

Sat Apr  6 18:40:08 CEST 2002  Jan Hubicka  <jh@suse.cz>

	* loop-bew (loop_delete_branch_edge):  Use cfg_layout_redirect_edge.

Sat Apr  6 17:32:53 CEST 2002  Jan Hubicka  <jh@suse.cz>

	* toplev.c (parse_options_and_default_flags):  Enable
	loop optimizations when PDO is available; enable register renaming
	at -O2.

Sat Apr  6 17:29:05 CEST 2002  Zdenek Dvorak

	* predict.c (process_note_predictions): Remove unused code.

	* loop.h (expected_loop_iterations): Moved declaration ...
	* basic-block.h (expected_loop_iterations) ... here.
	* loop-new.c (expected_loop_iterations): Moved function ...
	* cfgloop.c (expected_loop_iterations) ... here.
	* unroll-new.c (count_loop_iterations, unroll_loop_runtime_iterations,
	peel_loop, unroll_loop_new): Cleanup.

Sat Apr  6 14:05:29 CEST 2002  Josef Zlomek <zlomek@matfyz.cz>

	* bb-reorder.c (duplicate _basic_block) New function.
	(find_traces_1_round) Duplicate loop header of loops with little
	number of iterations.

Sat Apr  6 09:51:01 CEST 2002  Josef Zlomek <zlomek@matfyz.cz>

	* var-tracking (var_tracking_emit_notes): Emit notes BEFORE instead
	of AFTER bb->head.

Fri Apr  5 21:49:40 CEST 2002  Jan Hubicka  <jh@suse.cz>
			       Zdenek Dvorak  <rakdver@atrey.karlin.mff.cuni.cz>

	* cse.c (dead_libcall_p): Update counts properly; remove obsolette note.
	(delete_trivially_dead_insns): Update call of dead_libcall_p.

Fri Apr  5 21:32:37 CEST 2002  Jan Hubicka  <jh@suse.cz>

	* loop.c (canonicalize_condtion): Use gen_int_mode.

Fri Apr  5 19:43:25 CEST 2002  Jan Hubicka  <jh@suse.cz.

	* rs6000.c (call_operand): Fix.
	* toplev.c (rest_of_compilation): Do not use insns variable.

Thu Apr  4 20:12:23 CEST 2002  Pavel Nejedly  <bim@atrey.karlin.mff.cuni.cz>

	* final.c (output_asm_operand_names): Fix formating string.

Tue Apr  2 19:04:37 CEST 2002  Jan Hubicka  <jh@suse.cz>

	* Mainline merge (cfg-merge-20020204 tag)

Mon Apr  1 02:10:12 CEST 2002  Jan Hubicka  <jh@suse.cz>

	* unroll-new.c (simple_increment): Kill MINUS handling code.
	(simple_loop_p): Dump the information.
	(count_loop_iterations): Handle the overflows in short modes;
	dump output; fix emitting of code.
	(unroll_loop_runtime_iterations): Disable.
	* loop.h (lim_n, init_n): Use HOST_WIDE_INT.
	(flow_loop_dump): Dump expected number of iterations for each
	loop.

Sun Mar 31 15:44:06 CEST 2002  Jan Hubicka  <jh@suse.cz>

	* unroll-new.c (peel_loop): Peel when we can peel more than
	expected number of iterations.
	(unroll_loop_new): Unroll when expected number of iterations
	exceeds number of unrollings.

Sat Mar 30 13:17:15 CET 2002  Jan Hubicka  <jh@suse.cz>

	* ifcvt.c (find_double_test_block): Re-enable.

Fri Mar 29 17:23:56 CET 2002  Zdenek Dvorak  <rakdver@atrey.karlin.mff.cuni.cz>

	* loop-new.c (duplicate_loop_to_header_edge): Use sbitmap for wont_exit.
	(unswitch_loop): Modified duplicate_loop_to_header_edge use.
	* loop.h (duplicate_loop_to_header_edge): Declaration changed.
	* unroll-new.c (unroll_loop_constant_iterations,
	unroll_loop_runtime_iterations, peel_loop, unroll_loop_new): Modified
	duplicate_loop_to_header_edge use.

Thu Mar 28 18:41:25 CET 2002  Jan Hubicka  <jh@suse.cz>

	* unroll-new.c (peel_loop): Check can_duplicate_loop_p.

2002-03-27  Daniel Berlin  <dan@dberlin.org>

	* dwarf2out.c (mark_decl_loc_table): New function to mark
	decl_loc_table notes for GGC.
	(dwarf2out_initialize): Add decl_loc_table as a root.
        * flags.h: Add flag_var_tracking.
        * toplev.c (rest_of_compilation): Only do var tracking if
        flag_var_tracking is 1.
        Default flag_var_tracking to 1 if optimize > 0.

Wed Mar 27 23:24:40 CET 2002  Jan Hubicka  <jh@suse.cz>

	* loop-new.c (unswitch_single_loop): MAX_UNSWITCH_INSNS -->
	PARAM_MAX_UNSWITCH_INSNS.
	* params.def: Renamed parameters for new loop optimizer.
	* unroll-new.c (peel_loop, unroll_loop_new): Use new parameter names.

Wed Mar 27 17:01:35 CET 2002  Jan Hubicka  <jh@suse.cz>

	* var-tracking.c (set_location_part): Avoid overflow.

Wed Mar 27 16:58:53 CET 2002  Jan Hubicka  <jh@suse.cz>

	* loop-new.c (can_duplicate_loop_p): Disqualify loops formed
	using ABRNORMAL edges.

Wed Mar 27 16:56:30 CET 2002  Jan Hubicka  <jh@suse.cz>

	* cfgloopanal.c (create_preheader): Avoid crash on last BB in function.

2002-03-25  Daniel Berlin  <dan@dberlin.org>

	* ggc-common.c (ggc_mark_rtx_children): Mark pieces of
	NOTE_VAR_LOCATION properly.

	* final.c (final_scan_insn): Call var_location hook when we see a
	NOTE_VAR_LOCATION. 

	* debug.h (struct gcc_debug_hooks): Add new var_location hook.
	*out.c: Add empty var_location hook to end of debug hooks struct.

	* dwarf2out.c (dwarf2_debug_hooks): Add dwarf2out_begin_function,
	dwarf2out_var_location.
	(struct var_loc_node): New struct, for keeping track of variable
	locations.
	(lookup_decl_loc): New function, lookup a decl's var_loc list.
	(add_var_loc_to_decl): New function, add a variable location to a
	decl.
	(output_loc_list): No longer need base selection entries, since
	we force CU base address to 0 when there is code in more than one
	section. 
	(loc_descriptor): Handle VAR_LOCATION.
	(add_location_or_const_value_attribute): Add code to lookup and
	use var_location's to generate location lists.
	(dwarf2out_var_location): New function.
	(dwarf2out_begin_function): New function.
	(dwarf2out_init): Allocate location lookup table.

Fri Mar 22 18:43:56 CET 2002  Jan Hubicka  <jh@suse.cz>

	* mainline merge (cfg-merge-20022203 tag)

2002-03-22  Daniel Berlin  <dan@dberlin.org>

	* unroll-new.c (unroll_loop_constant_iterations): Print out
	reasons for not unrolling/if we unrolled succesfully, to
	rtl_dump_file.
	(unroll_loop_runtime_iterations): Ditto.
	(unroll_simple_loop): Ditto.
	(peel_loop): Ditto for peeling.
	* loop-new.c (unswitch_loop): Ditto for unswitching.

Mon Mar 18 21:14:24 CET 2002  Zdenek Dvorak  <rakdver@atrey.karlin.mff.cuni.cz>

	* Makefile.in (unroll-new.o): New.
	* basic-block.h (create_preheaders, create_preheader): Declaration
	changed.
	* cfgloopanal.c (create_preheaders, create_preheader): Modified to use
	flags.
	* loop-new.c (duplicate_loop_to_header_edge, can_duplicate_loop_p,
	expected_loop_iterations): Made global.
	(loop_optimizer_init): Create preheaders after cfglayout.
	(try_remove_path): Fixed a stupid bug.
	(duplicate_loop_to_header_edge): Modified to use flags.
	* loop.h (struct loop_desc): Description of simple loop.
	(expected_loop_iterations, can_duplicate_loop_p,
	duplicate_loop_to_header_edge): Declare.
	* params.def (MAX_UNROLLED_INSNS, MAX_UNROLL_TIMES,
	MAX_PEELED_INSNS, MAX_PEEL_TIMES): New options.
	* toplev.c (flag_new_unroll_loops, flag_new_unroll_all_loops,
	flag_peel_loops): New flags.
	(rest_of_compilation): Enable new loop peeling and unrolling.
	* unroll-new.c: New file.
	(simple_exit, simple_condition_p, simple_increment,
	variable_initial_value, simple_loop_p): New, simple loop recognition.
	(count_loop_iterations, unroll_loop_constant_iterations,
	unroll_loop_runtime_iterations, unroll_simple_loop): Simple loop
	unrolling.
	(unroll_loop_new, unroll_loops): Loop unrolling.
	(peel_loop, peel_loops): Loop peeling.

Sat Mar 16 13:09:57 CET 2002  Jan Hubicka  <jh@suse.cz>

	* cfgcleanup.c (cleanup_cfg): Fix updating of liveness.

Fri Mar 15 12:35:27 CET 2002  Josef Zlomek  <zlomek@matfyz.cz>

	* bb-reorder.c (find_traces_1_round): Don't rotate loop
	whose first bb is bb 0.

	* bb-reorder.c: documentation

Wed Mar 13 21:02:16 CET 2002  Jan Hubicka  <jh@suse.cz>

	* Merge from mainline (cfg-merge-20021203 tag).

Wed Mar  6 18:41:29 CET 2002  Jan Hubicka  <jh@suse.cz>

	* cfgrtl.c (purge_dead_edges): Set BB_DRITY flags if edge has been removed;
	fix return value.
	* combine.c (combine_instructions): Dirtify blocks where we failed to
	update liveness; purge dead edges; use update_life_info_in_dirty_blocks.
	* toplev.c (rest_of_compilation): Do not purge_dead_edges after combine.

Tue Mar  5 19:40:56 CET 2002  Jan Hubicka  <jh@suse.cz>

	* mainline merge (cfg-merge-20020503 tag).

Fri Mar  1 11:33:46 CET 2002  Zdenek Dvorak

	* loop-new.c (try_remove_path): Modified.

Don Feb 28 23:34:34 CET 2002  Zdenek Dvorak

	* loop-new.c (try_remove_path) Fix updating dominators.

Don Feb 28 16:39:10 CET 2002  Jan Hubicka  <jh@suse.cz>

	* mainline merge (cfg-merge-20022802 tag).

Thu Feb 28 13:42:26 CET 2002  Josef Zlomek <zlomek@matfyz.cz>

	* bb-reorder.c: Cleanup and bug fix - correct using of visited and
	duplicated flags.

Mit Feb 27 18:16:37 CET 2002  Jan Hubicka  <jh@suse.cz>

	* bb-reorder.c (find_traces_1_round): Fix copying.

Mon Feb 25 17:47:37 CET 2002  Zdenek Dvorak

	* Makefile.in (loop-new.o): Add dependency on params.h.
	* basic-block.h (flow_loop_tree_node_remove, flow_loop_nested_p): Declare.
	* cfglayout.c (cfg_layout_redirect_edge): New.
	(cfg_layout_duplicate_bb): Use it.
	* cfglayout.h (cfg_layout_redirect_edge): Declare.
	* cfgloop.c (flow_loop_nested_p): Made global.
	(flow_loop_tree_node_remove): New.
	(make_forwarder_block, canonicalize_loop_headers): Modified.
	* cfgloopanal.c (create_preheader, loop_split_edge_with): Modified.
	* loop-new.c (redirect_edge_with_update, loop_delete_branch_edge,
	split_loop_bb, remove_bbs, find_branch, scale_bbs_frequencies):
	New, cfg manipulation.
	(duplicate_loop, duplicate_subloops, copy_loops_to,
	alp_enum_p, add_loop, place_new_loop): New, loop
	structure duplication.
	(copy_bbs, remove_exit_edges, loopify, can_duplicate_loop_p,
	duplicate_loop_to_header_edge): New, loop body copying.
	(fix_loop_placement, expected_loop_iterations,
	scale_loop_frequencies): New, loop manipulation.
	(rpe_enum_p, remove_path, unswitch_loop, unswitch_single_loop,
	may_unswitch_on_p, unswitch_loops, try_remove_path): New, loop unswitching.
	* toplev.c (flag_unswitch_loops): New.
	(rest_of_compilation): Add loop unswitching.
	* params.def (MAX_UNSWITCH_INSNS, MAX_UNSWITCH_LEVEL): New options.

Thu Feb 21 21:02:22 CET 2002  Jan Hubicka  <jh@suse.cz>

	* Merge from mainline (cfg-merge-20022102 tag)
Thu Feb 21 22:05:13 CET 2002  Jan Hubicka  <jh@suse.cz>

	* (mark_conflict): Skip reg-reg copies.

Thu Feb 21 17:14:48 CET 2002  Zdenek Dvorak <rakdver@atrey.karlin.mff.cuni.cz>

	* Makefile.in (cfgloopanal.o): Fix dependencies.
	(cfgloop.o): Add dependecy on toplev.h
	* basic-block.h (verify_loop_structure, recount_dominator,
	redirect_immediate_dominators, create_preheaders,
	loop_split_edge_with, force_single_succ_latches,
	just_once_each_iteration_p, num_loop_insns): Declare.
	(create_preheader): Modified declaration.
	* cfganal.c (dfs_enumerate_from): Modified.
	* cfgloop.c (glb_enum_p): Modified.
	(flow_loop_nodes_find, canonicalize_loop_headers): Fix formating.
	(get_loop_body): Modified.
	(verify_loop_structure): New.
	* cfgloopanal.c (cbp_enum_p): New static function.
	(create_preheader): Modified.
	(create_preheaders): Fix spelling in comment.
	(just_once_each_iteration_p, num_loop_insns, loop_split_edge_with,
	force_single_succ_latches): New.
	* loop-new.c (recount_dominator): Fix, make global.
	(iterate_fix_dominators, redirect_immediate_dominators): New.
	(nearest_common_dominator): Fix.

Thu Feb 21 13:06:21 CET 2002  Zdenek Dvorak <rakdver@atrey.karlin.mff.cuni.cz>

	* cfglayout.c (cfg_layout_duplicate_bb): Modified.

Tue Feb 19 12:48:17 CET 2002  Jan Hubicka  <jh@suse.cz>

	* cfglayout.c (function_tail_eff_head): Rename to ...
	(function_footer): ... this one.
	(unlink_insn_chain, duplicate_insn_chain): New functions.
	(label_for_bb): Only call block_label and emit debug message.
	(record_effective_endpoints): Actually unlink the headers and footers.
	(fixup_reorder_cahin): Re-insert the unlinked sequences.
	(cfg_layout_duplicate_bb): Use duplicate_insn_chain.
	* cfglayout.h (struct reorder_block_def): New fields footer/header;
	remove eff_head/eff_end.

Tue Feb 19 11:33:55 CET 2002  Josef Zlomek  <zlomek@matfyz.cz>

        bb-reorder.c (find_traces_1_round): Bug fix in optimization of
	simple branches.

	bb-reorder.c (copy_bb_p): Set different parameters when bb is hot and
	when is not.

Sun Feb 17 19:13:54 CET 2002  Josef Zlomek  <zlomek@matfyz.cz>

	bb-reorder.c (find_traces_1_round): Better ordering of "if (A) B; C;"

Fri Feb 15 19:03:29 CET 2002  Jan Hubicka  <jh@suse.cz>

	* (abs and mov splitters/peep2s): Avoid generating of new register.

2002-02-15  Josef Zlomek  <zlomek@matfyz.cz>

        web.c (entry_register): Copy REG_ATTRS.

Sat Feb  9 20:03:18 CET 2002  Jan Hubicka  <jh@suse.cz>

	* Merge from mainline (cfg-merge-20020902).

Sat Jan 29 19:05:45 CET 2002  Jan Hubicka  <jh@suse.cz>

	* toplev.c (rest_of_compilation): Disable second GCSE pass.

Sat Jan 26 19:05:45 CET 2002  Jan Hubicka  <jh@suse.cz>

	* toplev.c (rest_of_compilation): Experimentally run two GCSE passes.

Sat Jan 26 20:20:34 CET 2002  Jan Hubicka  <jh@suse.cz>

	* cfgbuild.c (compute_outgoing_frequencies):  Cleanup.

	* cfgbuild.c (make_edges):  Look for the next basic block
	boundary, instead of next_nonnote_insn.

Thu Jan 24 22:03:47 CET 2002  Zdenek Dvorak <rakdver@atrey.karlin.mff.cuni.cz>

	* Makefile.in (OBJS): Add loop-new.o.
	(function.o, reg-stack.o, bb-reorder.o, tracer.o):
	Add dependency on basic-block.h.
	(loop-new.o): New.
	* basic-block.h (basic_block, struct loop, struct loops):
	Change loop representation.
	(flow_loop_outside_edge_p):
	Changed declaration.
	(flow_loop_tree_node_add): Declare.
	(LOOP_EXITS_DOMS): Removed (not used anywhere and hard to maintain
	just now).
	(flow_loop_outside_edge_p, flow_bb_inside_loop_p,
	get_loop_body, dfs_enumerate_from, add_bb_to_loop,
	remove_bb_from_loops, find_common_loop, create_preheader):
	Declare.
	(nearest_common_dominator, set_immediate_dominator,
	get_immediate_dominator, dominated_by_p,
	get_dominated_by, verify_dominators):
	Declare.
	* bb-reorder.c (reorder_basic_blocks): Modified.
	* cfg.c (entry_exit_blocks): Initialize new fields.
	(dump_flow_info): Modified.
	* cfganal.c (dfs_enumerate_from): New.
	* cfgbuild.c (find_basic_blocks): Zero liveness info;
	should be done cleaner way later.
	* cfglayout.c (cleanup_unconditional_jumps,
	cfg_layout_duplicate_bb, cfg_layout_initialize):
	Update loop structure.
	* cfglayout.h (reorder_block_def): Support for loop copying.
	(cfg_layout_initialize): Declaration modified.
	* cfgloop.c (flow_loop_nested_p, flow_loop_entry_edges_find,
	flow_loop_exit_edges_find, flow_loop_pre_header_scan,
	flow_loops_cfg_dump, flow_loops_free,
	flow_loop_pre_header_find, flow_loop_scan):
	Adapted for new loop represenation.
	(flow_loop_nodes_find, flow_loop_tree_node_add,
	flow_loops_tree_build, flow_loop_level_compute):
	Reworked to create new loop representation.
	(make_forwarder_block, canonicalize_loop_headers): New static
	functions.
	* cfgloopanal.c (for_each_insn_in_loop,
	not_invariant_rtx, test_invariants):
	Adapted for new loop represenation.
	(create_preheader): New.
	* loop.h (loop_optimizer_init, loop_optimizer_finalize):
	New loop optimizer interface declaration.
	* predict.c (estimate_loops_at_level, propagate_freq,
	estimate_probability, estimate_bb_frequencies):
	Adapted for new loop representation.
	* toplev.c (rest_of_compilation): Prepare for
	new loop optimizer.
	* tracer.c (tracer): Modified.
	* loop-new.c: New file.
	(get_immediate_dominator, set_immediate_dominator,
	get_dominated_by, nearest_common_dominator,
	dominated_by_p, verify_dominators, recount_dominator):
	Stupid dominator handling. Should be replaced soon.
	(loop_optimizer_init, loop_optimizer_finalize):
	New loop optimizer interface.

Thu Jan 24 16:15:21 CET 2002  Jan Hubicka  <jh@suse.cz>

	Mainline merger (cfg-merger-20022310 tag).

Wed Jan 23 15:06:52 CET 2002  Jan Hubicka  <jh@suse.cz>

	* emit-rtl.c (reg_attrs_htab): New static variable.
	(reg_attrs_htab_hash, reg_attrs_htab_eq, reg_attrs_mark,
	get_reg_attrs): New functions.
	(gen-rtx_REG_Offset, set_reg_attrs_from_mem,
	 set_mem_attrs_from_reg): New.
	(set_mem_decl): Kill.
	(init_once): Add new htab.
	* expr.h (set_mem_decl): Kill.
	(set_mem_attrs_from_reg, set_reg_attrs_from_mem): Declare.
	* final.c: Include expr.h
	(get_decl_from_op): Use REG_EXPR.
	(output_asm_operand_names): Allways output separator;
	output original pseudo if available.
	* function.c (assign_params): Do not handle REGNO_DECL.
	* gcse.c (delete_store, build_store_vectors): Call
	set_reg_attrs_from_mem.
	* ggc-common.c (ggc_mark_rtx_children): Mark REG_ATTRS.
	* integrate.c: Kill REGNO_DECL handling.
	* loop.c (load_mems): Call set_reg_attrs_from_mem.
	* print-rtl.c (print_rtx): Output REG_ATTRTS.
	* regclass.c (reg_scan_mark_refs): Propagate attrs;
	do not handle REGNO_DECL.
	* reload1.c (alter_reg): Use set_mem_attrs_from_reg.
	* rtl.def (REG): Add third field.
	* rtl.h (struct reg_attrs): New.
	(rtunion_def): Add rtreg.
	(X0MEMATTR): CHeck that operand is MEM.
	(X0REGATTR): New.
	(REG_ATTRS, REG_EXPR, REG_OFFSET): New macros.
	(gen_rtx_REG_offset): Declare.
	* simplify-rtx (simplify_subreg0: Use gen_rtx_REG_offset.

Wed Jan 23 14:04:31 CET 2002 Josef Zlomek  <zlomek@matfyz.cz>

	* bb-reorder.c (copy_bb_p): bug fix: avoid infinite loop.

Mon Jan 21 20:14:13 CET 2002  Jan Hubicka  <jh@suse.cz>

	* Makefile.in (md_file): Add dependancy on midrtl.md.
	* emit-rtl.c (try_split): Avoid recursive splitting in
	RTL lowering process; avoid abort on badly updated probability
	notes for now.
	* function.c (prepare_function_start): RTL form is initiallly
	RTL_FORM_MID.
	* function.h (struct function): Add rtl_form.
	* genrecog.c (pred_table): Add generic operands.
	* gensupport.c (init_md_reader): Implicitly inlucde midrtl.md
	file.
	* optabs.c (prepare_generic_operand): New function.
	(expand_binop, expand_unop, emit_cmp_and_jump_insns):
	Generate midlevel RTL.
	* recog.c (generic_address, generic_src_operand, generic_dest_operand):
	New functions.
	* recog.h (generic_address, generic_src_operand, generic_dest_operand):
	Declare.
	* toplev.c (rest_of_compilation): Do RTL lowering.
	* i386.c (ix86_expand_int_movcc): Do not crash on DImode comparisons.
	* midrtl.md: New file.

Sat Jan 19 19:05:45 CET 2002  Jan Hubicka  <jh@suse.cz>

	* toplev.c (rest_of_compilation): Experimentally run two GCSE passes.

Sat Jan 19 00:19:20 CET 2002  Jan Hubicka  <jh@suse.cz>

	* Makefile.in (coalesce.o): Add.
	* coalesce.c: New file.
	* rtl.h (coalesce): Declare.

Thu Jan 17 15:09:02 CET 2002  Jan Hubicka  <jh@suse.cz>

	* combine.c (simplify_comparison): Strengthen the condition of
	sign_extension removing case.

Thu Jan 17 13:41:55 CET 2002  Jan Hubicka  <jh@suse.cz>

	* df.c (df_ref_create, df_ref_record_1, df_ref_record): Kill BB argument.
	* df.h (struct ref): Kill B.
	(DF_REF_BB, DF_REF_BBNO): Use BLOCK_FOR_INSN.

	* basic-block.h (PROP_EQUAL_NOTES): New flag.
	* flow.c (propagate_one_insn): Use it.
	(mark_used_regs): Handle NIL.

Wed Jan 16 19:11:19 CET 2002  Jan Hubicka  <jh@suse.cz>

	* gcse.c (struct expr): Add insn.
	(struct occr): Add can_delete_p.
	(end_bb_insertion_point): Break out from ...
	(insert_insn_end_bb): ... here; Remove parameter pre;
	use hoist_insn_after.
	(can_inisert_insn_end_bb_p, can_insert_insn_edge_p): New.
	(process_insert_insn): Kill.
	(pre_edge_try_insert): New.
	(gcse_emit_move_after): New function.
	(gcse_main): Build and maitain liveness information.
	(compute_local_properties): Initialize can_delete_p.
	(want_to_gcse): Simplify.
	(insert_expr_in_table): Record insn for expr.
	(hash_scan_set): Avoid gcseing unused sets.
	(hoist_code): Validate motion first.

	* cfgrtl.c: Include insn-config.h, recog.h and expr.h
	(hoist_test_store, hoist_update_store): New static functions.
	(can_hoist_insn, hoist_insn_after, hoist_insn_to_edge): New
	global functions.
	* emit-rtl.c (emit_copy_of_insn_after): New.
	* cfglayout.c (cfg_layout_duplicate_bb): Use emit_copy_of_insn_after.
	* basic-block.h (can_hoist_insn_p, hoist_insn_after,
	hoist_insn_to_edge): Declare.
	* Makefile.in (cfgrtl.o): Add dependencies.
	* rtl.h (emit_copy_of_insn_after): Declare.

	* cfgloopanal.c: New file.
	* basic_block.h (struct loop_invariants, loop_invariants,
	free_loop_invariants, test_invariants, loop_invariant_rtx_p): Declare.

2002-01-14  Josef Zlomek  <zlomek@matfyz.cz>

	cfg.c (dump_edge_info): added dumping of EDGE_CAN_FALLTHRU.
	bb-reorder.c (find_traces_1_round): fixed bug in computing the
	iterations of the loop.

Mon Jan 14 21:43:53 CET 2002  Jan Hubicka  <jh@suse.cz>

	* Merge from mainline (cfg-merge-20021401 tag).

Mon Jan 14 15:58:03 CET 2002  Jan Hubicka  <jh@suse.cz>

	* predict.c (estimate_probability): Ensure there are two edges leaving insn.
	(estimate_bb_frequencies): Do not reload REG_BR_PROB notes.

Sat Jan 12 18:53:24 CET 2002  Jan Hubicka  <jh@suse.cz>

	* cfgcleanup.c (try_forward_edges): Avoid infinite loop at infinite
	threaded loop.

Thu Jan 10 19:34:16 CET 2002  Jan Hubicka  <jh@suse.cz>

	* gcse.c (hash_scan_set): Use CONSTANT_INSN_P.
	(cprop_insn): Likewise.

Thu Jan 10 18:30:31 CET 2002  Jan Hubicka  <jh@suse.cz>

	* Mainline merger (cfg-merge-20021001 tag).

Thu Jan 10 10:58:53 CET 2002  Jan Hubicka  <jh@suse.cz>

	* basic-block.h (update_br_prob_note): Declare.
	* cfgcleanup.c (try_crossjump_to_edge): Use update_br_prob_note.
	* cfglayout.c (fixup_reorder_chain): Likewise.
	* cfgrtl.c (update_br_prob_note): New.
	(verify_flow_info): Verify the br_prob notes.
	* ifcvt.c (process_double_test): Likewise.

Thu Jan 10 10:44:38 CET 2002  Jan Hubicka  <jh@suse.cz>

	* (try_forward_edges):  Properly initialize nthreaded_edges;
	update edge probabilities to match.

Wed Jan  9 14:14:37 CET 2002  Josef Zlomek  <zlomj9am@artax.karlin.mff.cuni.cz>

	* basic-block.h: New flag EDGE_CAN_FALLTHRU
	* cfganal.c (set_edge_can_fallthru_flag): New function; marks the edges
	that can be made fallthru.
	* bb-reorder.c (find_traces_1_round): Avoid duplication of the loop
	headers and rotate loops so that the loop header is the last bb, make
	traces only through EDGE_CAN_FALLTHRU edges, indentation fixes.

Wed Jan  9 14:14:37 CET 2002  Josef Zlomek  <zlomj9am@artax.karlin.mff.cuni.cz>

	* cfgcleanup.c (merge_blocks): Fix debug output.

Mon Jan  7 15:16:21 CET 2002  Jan Hubicka  <jh@suse.cz>

	Merge from mainlnie (cfg-merge-20020701 tag).

Sun Jan  6 21:04:57 CET 2002  Jan Hubicka  <jh@suse.cz>

	* unroll.c (copy_loop_body): Always properly update JUMP_LABEL and
	LABEL_NUSES.

Sat Jan  5 00:43:43 CET 2002  Jan Hubicka  <jh@suse.cz>

	* cfgcleanup.c: Include tm_p.h
	(mark_effect): Fix handling of hard register; fix handling of SET
	* cfgcleanup.c (try_forward_edges): Allow multiple jump threading.

Thu Jan  3 21:52:09 CET 2002  Jan Hubicka  <jh@suse.cz>

	* cfgcleanup.c (outgoing_edges_match): Be more conservative on the
	requirement to match perfectly.
	* cfglayout.c (fixup_reorder_chain): Remove unused variable.
	* predict.c: Inlude profile.h
	(MIN_COUNT): Rename to MIN_COUNT_FRACTION
	(maybe_hot_bb_p, probably_cold_bb_p, probably_never_executed_bb_p):
	Use the information about maximal counter in the program.

Thu Nov 22 02:24:39 CET 2001  Zdenek Dvorak <rakdver@atrey.karlin.mff.cuni.cz>

	* Makefile.in (profile.o): Add dependency on libfuncs.h and gthr.h.
	(XCFLAGS): Add GTHREAD_FLAGS.
	* attribs.c (handle_no_profile_attribute): New static function.
	(c_common_attribute_table): New attribute "no_profile".
	* cfganal.c (fix_position): New static function.
	(flow_call_edges_add): Modified.
	* crtstuff.c: Prevent functions from being profiled.
	* gcov-io.h: Prevent functions from being profiled.
	* gengenrtl.c: Prevent functions from being profiled.
	* function.c (expand_function_start): Set no_profile.
	* function.h (struct function): Add arc_counters_adress and no_profile.
	* final.c (end_final): Emit LPBF label.
	* flags.h (flag_unsafe_profile_arcs): New.
	* libfuncs.h (enum libfunc_index): Add LTI_find_arc_counters.
	* libgcc2.c: Include gthr.h.  Prevent functions from being profiled.
	(__bb_find_arc_counters, __bb_thread_start_func, __bb_thread_end_func):
	New.
	(__bb_exit_func, __bb_init_func, __bb_find_arc_counters,
	__bb_thread_start_func, __bb_thread_end_func): Handle thread-safe
	profiling.
	* libgcc2.h (__bb_init_func): Modified declaration.
	(__bb_thread_start_func, __bb_thread_end_func, __bb_find_arc_counters):
	Declared.
	* optabs.c (init_optabs): Init __bb_find_arc_counters.
	* profile.c: Include libfuncs.h and gthr.h.
	(insert_profiler_initialization): New static function.
	(instrument_edges): Modified.
	(branch_prob): Handle no_profile, insert per-function profiler code.
	(find_spanning_tree): More information to dump.
	(gen_edge_profiler): Generate thread-safe profiling code.
	(output_func_start_profiler): Modified.
	* toplev.c (flag_unsafe_profile_arcs): New.
	(f_options): New flag "unsafe-profile-arcs".

Tue Jan  1 21:12:40 CET 2002  Pavel Nejedly  <bim@atrey.karlin.mff.cuni.cz

	* Makefile.in (LIBGCC_DEPS): Added missing dependency on gcov-io.h
        (profile.o): New dependency profile.h
        (final.o): New dependency profile.h
        * profile.h: New file. New global structure profile_info.
        * final.h (count_edges_instrumented_now): Declare.
        (current_function_cfg_checksum): Declare.
        (function_list): New structure.
        (functions_head, functions_tail): New static variables.
        (end_final): Emits more data, removed some -ax stuff.
        (final): Stores function names and chcksums.
        * gcov-io.h (__write_gcov_string): New function.
        (__read_gcov_string): New function.
        * gcov.c (read_profile): New function.
        (create_program_flow_graph): Uses read_profile instead of reading
	da_file.
        (read_files): Removed da_file checking, it's done by read_profile now.
        * libgcc2.c (bb_function_info): New structure.
        (bb): New field in structure, removed some -ax stuff.
        (__bb_exit_func): Changed structure of da_file.
        * profile.c (count_edges_instrumented_now): New global variable.
        (current_function_cfg_checksum): New global variable.
        (max_counter_in_program): New global variable.
        (get_exec_counts): New function.
        (compute_checksum): New function.
        (instrument_edges): Sets count_edges_instrumented_now.
        (compute_branch_probabilities): Uses get_exec_counts instead of
	reading da_file.
        (branch_prob): Calls compute_checksum and writes extra data to bbg_file.
        (init_branch_prob): Removed da_file checking, done in get_exec_counts
	now.
        (end_branch_prob): Removed da_file checking, done in get_exec_counts
	now.
        * gcov.texi: Updated information about gcov file format.

Mon Dec 31 15:39:49 CET 2001  Jan Hubicka  <jh@suse.cz>

	* cfgcleanup.c (outgoing_edges_match): Add debug output.
	* tracer.c (MIN_COUNT, MIN_FREQUENCY): Kill.
	(MIN_BRANCH_PROBABILITY): New macro.
	(find_best_successor): Use it.

Mon Dec 31 14:46:20 CET 2001  Jan Hubicka  <jh@suse.cz>

	* cfgcleanup.c (outgoing_edges_match): Fix computing of probabilities.

Sun Dec 30 17:14:22 CET 2001  Jan Hubicka  <jh@suse.cz>

	* cfgcleanup.c (cleanup_cfg): Do not kill tail recursion label list.
	* sibcall.c (optimize_sibling_and_tail_recursive_call): Do not
	rebuild cfg;  free tail recursive list.
	* toplev.c (rest_of_compilation): Dump more of sibcalling;
	kill NOTE_INSN_PREDICTION notes.

Sat Dec 29 15:25:45 CET 2001  Jan Hubicka  <jh@suse.cz>

	* Mainline merger (cfg-merge-20012912 tag).

Thu Dec 20 22:14:00 CET 2001  Jan Hubicka  <jh@suse.cz>

	* basic-block.h (maybe_hot_bb_p, probably_cold_bb_p,
	probably_never_executed_bb_p): New functions.
	* cfgcleanup.c (outgoing_edges_match): Use them.
	* predict.c (MIN_COUNT, MIN_FREQUENCY): New macros.
	(maybe_hot_bb_p, probably_cold_bb_p,
	probably_never_executed_bb_p): New functions.
	* tracer.c (ignore_bb_p): Use them.

	* function.h (function): Add new filed function_frequency.
	* predict.c (compute_function_frequency): New function.
	(estimate_probability): Call it.
	* varasm.c (in_section, unlikely_executed_text_section,
	hot_text_section): New static function.
	(function_section): Use them.
	* elfos.h (HOT_TEXT_SECTION_ASM_OP,
	UNLIKELY_EXECUTED_TEXT_SECITON_ASM_OP): New.

Thu Dec 20 20:36:33 CET 2001  Jan Hubicka  <jh@suse.cz>

	* libgcc2.c: Merge from mainline.

Thu Dec 20 18:15:04 CET 2001  Jan Hubicka  <jh@suse.cz>

	* predict.def: Fix.

Thu Dec 20 18:02:04 CET 2001  Jan Hubicka  <jh@suse.cz>

	* unroll.c (unroll_loops): Fix LOOP_CONDITION heuristics.

Mon Dec 17 17:34:39 CET 2001  Jan Hubicka  <jh@sue.cz>

	* toplev.c (rest_of_compilation): Revert:
	Perform gcse after tracing.

Fri Dec 14 23:43:29 CET 2001  Jan Hubicka  <jh@suse.cz>

	* Merge from mainline (cfg-merge-20011214 tag).

Fri Dec 14 23:17:33 CET 2001  Jan Hubccka  <jh@suse.cz>

	* toplev.c (rest_of_compilation): Perform gcse after tracing.

Wed Dec 12 16:21:03 CET 2001  Jan Hubicka  <jh@suse.cz>

	* tracer.c (DYNAMIC_COVERAGE, MAXIMAL_CODE_GROWTH): Use floating point
	value to hold ratio.
	(MIN_BRANCH_RATIO): New constant.
	(find_best_successor, find_best_predecessor): Use it.
	(tail_duplicate): Rescale floats to integers.

Wed Dec 12 15:50:18 CET 2001  Jan Hubicka  <jh@suse.cz>

	* predict.c (estimate_bb_frequencies): Do estimation even when
	feedback is available but given function is not benchmarked.

Wed Dec 12 15:30:25 CET 2001  Jan Hubicka  <jh@suse.cz>

	* cfgcleanup.c (insns_match_p): Break out from ...;
	(flow_find_cross_jump): ... here;
	(outgoing_edges_match): Add parameter MODE; attempt to match everything
	except for tablejumps.
	(try_crossjump_to_edge): Accept complex edges.
	(try_crossjump_bb): Likewise.

Wed Dec 12 14:15:48 CET 2001  Jan Hubicka  <jh@suse.cz>

	* predict.c (estimate_probability): Distribute the loop exit
	probability according to number of exit edges.

Wed Dec 12 09:49:17 CET 2001  Jan Hubicka  <jh@suse.cz>

	* predict.c (predicted_by_p): New static function.
	(last_basic_block_p): Rename from is_last_basic_block; update.
	(estimate_probability): Disable loop heuristics if CONTINUE is present;
	replace ERROR_RETURN by EARLY_RETURN heuristics; kill PRED_OPCODE_NONZERO
	heuristics.
	(process_note_prediction): Ignore ignore_in_last value; do not use
	PRED_ERROR_RETURN heuristics.
	* predict.def: Update probabilities; kill PRED_OPCODE_NONZERO
	and PRED_ERROR_RETURN; add PRED_EARLY_RETURN.
	* stmt.c (expand_continue_loop): Predict continue to happen.

Tue Dec 11 16:51:17 CET 2001  Josef Zlomek  <zlomek@matfyz.cz>

	* bb-reorder.c: improved Software Trace Cache with duplication of basic
	blocks.
	* cfglayout.h: Added elements 'duplicated' and 'original' to struct
	reorder_block_def.
	* Makefile.in: Added dependencies on fibheap.h.

Tue Dec 11 10:40:18 CET 2001  John Wehle  <john@feith.com>

	* cfganal.c (flow_depth_first_order_compute): Always
	increment dfsnum.

	* basic-block.h (flow_preorder_transversal_compute): Declare.
	* cfganal.c (flow_preorder_transversal_compute): Implement.

Thu Dec  6 12:13:24 CET 2001  Jan Hubicka  <jh@suse.cz>

	* cfgcleanup.c (flow_find_cross_jump): Replace tests for note
	by active_insn_p; count conditional jump as instruction.

Fri Nov 30 21:42:06 CET 2001  Jan Hubicka  <jh@suse.cz>

	* Merger from mainline (cfg-merger-20011130 tag).

Fri Nov 30 19:45:41 CET 2001  Jan Hubicka  <jh@suse.cz>

	* reload.c (find_reloads): Update the dupplicates after swappingg.

Wed Nov 28 13:51:24 CET 2001  Jan Hubicka  <jh@suse.cz>

	* cfgbuild.c (inside_basic_block_p, control_flow_insn_p): Break out from ...
	(count_basic_blocks): ... here.
	(find_basic_blocks, find_bb_boundaries): Cleanup.

Tue Nov 27 01:07:51 CET 2001  Jan Hubicka  <jh@suse.cz>

	* predict.c (estimate_probability): Refine pointer heuristic;
	split opcode into multiple heuristics.
	* predict.def (PRED_OPCODE_POSITIVE, PRED_OPCODE_NONZERO,
	PRED_OPCODE_NONEQUAL, PRED_FPOPCODE): New.

Mon Nov 26 13:52:12 CET 2001  Jan Hubicka  <jh@suse.cz>

	* ifcvt.c: Include optabs.h
	(num_possible_double_test_blocks, num_updated_double_test_blocks,
	num_removed_blocks_double_test): New static variables.
	(double_test_info): New structure.
	(nonzero_test, double_test_ior_and, m1_test_find_double_test_blocks,
	process_double_test_block, block_side_effects_p): New static functions.
	(if_convert): Compute statistics.
	(find_if_header): Call find_double_test_block.

Mon Nov 26 13:37:24 CET 2001  Jan Hubicka  <jh@suse.cz>

	* ifcvt.c (process_double_test_block): Fix negative counts.

Mon Nov 26 12:53:11 CET 2001  Jan Hubicka  <jh@suse.cz>

	* c-common.h (GOTO_FAKE_P): New macro.
	* tree-inline.c (GOTO_FAKE_P): Set.
	* c-tree.texi (GOTO_FAKE_P): Document.
	* Makefile.in (c-semantics.o): Add predict.h dependency.
	(stmt.o): Fix predict.h depdendency.

	* c-semantics.c: Include predict.h;
	(expand_stmt): Drop prediction on goto.
	* predict.c (preocess_note_predictions): Fix formating.
	* predict.def (PRED_CONTINUE, PRED_NEGATIVE_RETURN): New predictors.
	* stmt.c (maybe_error_return): Kill.
	(return_prediction): New.
	(expand_goto): Do not generate predictions.
	(expand_continue_loop): Do generate prediction.
	(expand_null_return): Do not generate predictions.
	(expand_value_return): Use return_prediction.

Mon Nov 26 11:53:36 CET 2001  Jan Hubicka  <jh@suse.cz>

	* sibcall.c (optimize_sibling_and_tail_recursive_call): Kill
	NOTE_INSN_RETURN and NOTE_INSN_PREDICTION leaked to the code.

Mon Nov 26 11:48:57 CET 2001  Jan Hubicka  <jh@suse.cz>

	* cfganal.c (flow_dfs_compute_reverse_add_bb): set visited bit.
	(flow_dfs_compute_reverse_execute): Add only unvisited blocks.

2001-11-25  Andreas Jaeger  <aj@suse.de>

	* toplev.c (rest_of_compilation): Call
	find_exception_handler_labels.
	Patch by Jan Hubicka <jh@suse.cz>.

Thu Nov 15 11:29:10 CET 2001  Zdenek Dvorak  <rakdver@atrey.karlin.mff.cuni.cz>
	
	* Makefile.in (stmt.o): Add predict.h dependency.
	* basic-block.h (CLEANUP_UNREACHABLE_ONLY): New constant.
	(note_prediction_to_br_prob): Declare.
	* cfgcleanup.c (cleanup_cfg): Allow to only delete unreachable blocks.
	* predict.c (process_note_prediction, process_note_predictions,
	is_last_basic_block): New static functions.
	(estimate_probability): Moved noreturn blocks handling to
	process_note_predictions.
	(note_prediction_to_br_prob): New function.
	* predict.def (PRED_GOTO, PRED_CONST_RETURN, PRED_NIL_RETURN):
	New predictions.
	* predict.h (IS_TAKEN, IGNORE_IN_LAST): New constants.
	* print-rtl.c (print_rtx): Printing of NOTE_INSN_PREDICTION.
	* rtl.h (NOTE_INSN_PREDICTION, NOTE_INSN_RETURN): New.
	(NOTE_PREDICTION, NOTE_PREDICTION_ALG, NOTE_PREDICTION_FLAGS,
	NOTE_PREDICT): New.
	* rtl.c (note_insn_name): Names for them.
	* stmt.c: Include predict.h.
	(maybe_error_return): New static function.
	(expand_goto): Emit prediction note.
	(expand_null_return, expand_value_return): Emit prediction and return
	notes.
	* toplev.c (rest_of_compilation): Call note_prediction_to_br_prob.
	* cfgrtl.c (can_delete_note_p, flow_delete_block): Removing our notes
	when their block disappear.

Fri Nov 23 14:42:40 CET 2001  Jan Hubicka  <jh@suse.cz>

	* invoke.texi: (-fweb, -dZ): Document.
	(-O3): Document that -fweb is enabled.
	* passes.texi (web construction pass): Document.

Thu Nov 22 16:51:20 CET 2001  Jan Hubicka  <jh@suse.cz>

	Mainline merger (cfg-merger-20011122 tag).

Wed Nov 21 19:41:48 CET 2001  Jan Hubicka  <jh@suse.cz>

	* tracer.c: Revert to original algorithm.

Wed Nov 21 10:47:35 CET 2001  Jan Hubicka  <jh@suse.cz>

	* tracer.c: Include flags.
	(ignore_bb_p): New function.
	(MIN_COUNT, MIN_FREQUENCY, DYNAMIC_COVERAGE, MAXIMAL_CODE_GROWTH):
	new constatns.
	(better_p): Avoid roundoff errors.
	(find_best_successor, find_best_predecessor): Ignore ignored
	blocks.
	(is_trace_head_p): Do not care ENTRY_BLOCK_PTR.
	(tail_duplicate): Ignore ignored blocks; limit code growth

Tue Nov 20 18:52:33 CET 2001  Jan Hubicka  <jh@suse.cz>

	* cfg.c (dump_flow_info):  Verify the profile.

	* profile.c (compute_branch_probabilites):  Compute probabilities 
	for entry/exit edges; estimate probabilities for zero counts.

	* cfglayout.c (cfg_layout_duplicate_bb):  Fix profile updating
	code.

Tue Nov 20 16:58:37 CET 2001  Jan Hubicka  <jh@suse.cz>

	* web.c: Include function.h
	(union_defs): Copy pseudo's flags; union noop moves.

Mon Nov 19 14:13:35 CET 2001  Jan Hubicka  <jh@suse.cz>

	* cfglayout.c (cfg_layout_duplicate_bb): Avoid overflow.

Mon Nov 19 13:22:58 CET 2001  Jan Hubicka  <jh@suse.cz>

	* gcse.c (delete_null_pointer_checks_1): Do not use delelete_list;
	call purge_dead_edges after removing.
	(delete_null_pointer_checks): Do not handle delete_list.

Mon Nov 19 12:05:45 CET 2001  Jan Hubicka  <jh@suse.cz>

	* gcse.c (delete_null_pointer_checks): Call delete_related_insns.

Sun Nov 18 11:55:20 CET 2001  Jan Hubicka  <jh@suse.cz>

	* predict.c (block_info_def, edge_info_def): Add volatiles.

Sat Nov 17 21:10:33 CET 2001  Jan Hubicka  <jh@suse.cz>

	* i386.c (ix86_cc_mode): Accept USE.

	* cse.c (cse_insn): really do not record equivalences of the
	last instruction.

Sat Nov 17 19:12:52 CET 2001  Jan Hubicka  <jh@suse.cz>

	* web.c (union_defs): Union uses of the instruction that
	do use same pseudo.

Sat Nov 17 16:30:45 CET 2001  Jan Hubicka  <jh@suse.cz>

	* toplev.c (rest_of_compilation): Fix ordering problem of PDO.
	* tracer.c: New heuristics.

Sat Nov 17 14:32:07 CET 2001  Jan Hubicka  <jh@suse.cz>

	* cfgrtl.c (purge_dead_edges):  Cleanup EDGE_ABNORMAL flag if computed
	jump is turned into simplejump.

Fri Nov 16 21:13:46 CET 2001  Jan Hubicka  <jh@suse.cz>

	* gcse.c (try_replace_reg): Copy RTX before creating note.

Thu Nov 15 18:18:50 CET 2001  Jan Hubicka  <jh@suse.cz>

	* Makefile.in (web.o): Add.
	* rtl.h (web_main): Add prototype.
	* timervar.def (TV_WEB): New.
	* toplev.c (dump_file_index): Add DFI_web.
	(dump_file_info): Add "web".
	(flag_web): New static variable.
	(f_options): Add "web".
	(rest_of_compilation): Call web_main.
	(toplev_main): Add flag_web.
	* web.c: New file.

	* df.h (df_ref_flags): New uenum.
	(DF_REF_FLAGS): New macro.
	(struct ref): Add field "flags".
	* df.c (HANDLE_SUBREG): Remove.
	(df_ref_create): Likewise; set flags field of ref.
	(df_def_record_1): Strip down read_write subreg; remove
	commented out code; set READ_WRITE flag.
	(read_modify_subreg_p): New static function.
	(df_uses_record): Cleanup SET handling; set READ_WRITE flag;
	new argument "flags".
	(df_insn_refs_record): Update call of df_uses_record.
	(df_insn_modify): Avoid #if 0 around comment.
	(df_dump): Dump the read/write flag.

Thu Nov 15 16:53:20 CET 2001  Jan Hubicka  <jh@suse.cz>

	* predict.c (propagate_freq): Make cyclic_probability and frequency
	volatile

Wed Nov 14 18:25:13 CET 2001  Jan Hubicka  <jh@suse.cz>

	* tracer.c (tracer): Re-add lost mark_dfs_back_edges call.

Wed Nov 14 14:48:07 CET 2001  Jan Hubicka  <jh@suse.cz>

	* cfglayout.c (cfg_layout_duplicate_bb): Fix libcalls.

Wed Nov 14 14:07:20 CET 2001  Jan Hubicka  <jh@suse.cz>

	* tracer.c (count_insns): New function.
	(construct_traces): Tweek heuristics.

Wed Nov 14 14:04:14 CET 2001  Jan Hubicka  <jh@suse.cz>

	* cfglayout.c (cfg_layout_duplicate_bb): Grok libcall sequences.

Tue Nov 13 16:26:24 CET 2001  Jan Hubicka  <jh@suse.cz>

	* cfgclenaup.c (try_forward_edges, try_crossjump_to_edge):
	Never produce negative counts/frequencies.
	* cfglayout.c (cfg_layout_duplicate_bb): Likewise.
	* cfgrtl.c (verify_flow_info): Check frequncies.

Tue Nov 13 15:54:33 CET 2001  Jan Hubicka  <jh@suse.cz>

	* toplev.c (DFI_tracer): New.
	(dump_file_info): Add DFI_tracer.
	(rest_of_compilation): reorganize tracer handling; add some
	sanity checks.
	* timervar.def (TV_TRACER): New.

2001-11-13  Andreas Jaeger  <aj@suse.de>

	* cfgcleanup.c (thread_jump): Rename label fail to avoid warning.

Tue Nov 13 14:05:19 CET 2001  Jan Hubicka  <jh@suse.cz>

	* cfglayout.c (cleanup_unconditional_jumps): Do not get confused
	by dead jumptables.

Tue Nov 13 13:30:32 CET 2001  Jan Hubicka  <jh@suse.cz>

	* c-decl.c (c_expand_body): Fix TV_EXPAND nesting problem;
	measure integration time separately.

	* gcse.c (delete_null_pointer_checks_1): Fix CFG udpate.

	* toplev.c (rest_of_compilation): Avoid most of cfg rebuilds.

Tue Nov 13 12:28:49 CET 2001  Jan Hubicka  <jh@suse.cz>

	* predict.c (expected_value_to_br_prob): Delete the note
	once transformed.

Mon Nov 12 19:58:01 CET 2001  Andreas Jaeger <aj@suse.de>

	* tracer.c: Fix spelling and whitespace.

Mon Nov 12 19:23:18 CET 2001  Josef Zlomek  <zlomek@matfyz.cz>

	* cfgloop.c (flow_loops_find): Use the information of the depth
	first search order of the CFG correctly when finding natural loops.

Mon Nov 12 18:56:36 CET 2001  Jan Hubicka  <jh@suse.cz>

	* Makefile.in (cfgcleanup.o): Add cselib.h dependancy.
	* basic-block.h (CLEANUP_THREADING): New constant.
	* cfgcleanup.c: Include cselib.h
	(thread_jump, mark_effect): New functions.
	(try_forward_edges): Do jump threading when asked for.
	* jump.c (mark_modified_reg, save_regs, num_same_regs, modified_regs,
	modified_mem, thread_jumps, rtx_equal_for-thread_p): Kill.
	* rtl.h (thread_jumps, rtx_equal_for_thread_p): Kill.
	* toplev.c (rest_of_compilation): Do now call thread_jumps; use
	CLEANUP_THREAD instead.

Mon Nov 12 18:36:09 CET 2001  Jan Hubicka  <jh@suse.cz>

	* Makefile.in (tracer.o): Add.
	* rtl.h (tracer): New function.
	* toplev.c (flag_tracer): New.
	(f_options): add -ftracer.
	(rest_of_compilation): Call tracer.
	(toplev_main): Enable tracer at -O2.
	* tracer.c: New file.

Mon Nov 12 17:02:31 CET 2001  Jan Hubicka  <jh@suse.cz>

	* cfglayout.c (cfg_layout_can_duplicate_bb_p,
	cfg_layout_duplicate_bb): New functions.
	* cfglayout.h (cfg_layout_can_duplicate_bb_p,
	cfg_alyout_duplicate_bb): Declare.

Mon Nov 12 16:35:21 CET 2001  Jan Hubicka  <jh@suse.cz>

	* cfglayout.c (fixup_fallthru_exit_predecesor): New static function.
	(cfg_layout_finalize): Use it.
	* bb-reorder.c (HAVE_epilogue): Remove.
	(make_reorder_chain): Do not care special placement of 
	last basic block.

Mon Nov 12 16:25:53 CET 2001  Jan Hubicka  <jh@suse.cz>

	* cfglayout.c (cleanup_unconditional_jumps): New static function.
	(cfg_layout_initialize): Use it.

Mon Nov 12 14:19:07 CET 2001  Jan Hubicka  <jh@suse.cz>

	* cfglayout.c (struct scope_def): Kill fields note_beg, note_end,
	bb_beg, bb_end, bbs, num_bbs; add block.
	(scope_forest_info): Kill.
	(forest): Rename to scope_tree.	
	(relate_bbs_with_scope, insert_intra_1, insert_intra_bb_scope_notes,
	insert_inter_bb_scope_notes): Kill.
	(rebuild_scope_notes): Take scope parameter; rewrite.
	(dump_scope_forest): Rename to dump_scope_tree.
	(dump_scope_forest_1): Rename to dump_scope_tree_1.
	(free_scope_forest): Rename to free_scope_tree; rewrite.
	(free_scope_forest_1): Kill.
	(get_next_bb_note, get_prev_bb_note): Kill.
	(set_insn_scopes, regenerate_block_notes): New.
	(INSN_SCOPE): New.
	(insn_scope): New varray.

