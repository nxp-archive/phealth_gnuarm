2008-06-25  Michael Meissner  <michael.meissner@amd.com>

	* c-common.c (parse_optimize_options): Cast alloca returns to the
	appropriate pointer type.

	* config/i386/i386.c (ix86_target_string): Cast xmalloc return to
	the appropriate pointer type.
	(ix86_valid_option_attribute_inner_p): Cast alloca return to the
	appropriate pointer type.

2008-06-22  Michael Meissner  <michael.meissner@amd.com>

	* attribs.c (toplevel): Add c-common.h include file.
	(decl_attributes): Convert #pragma GCC optimize into
	attribute((optimize(...))), and #pragma GCC option into
	attribute((option(...))).

	* doc/extend.texi: Update option attribute documentation.
	Document optimize attribute.  Document that the hot attribute
	turns on -O3 optimization for the function.  Document that the
	cold attribute turns on -Os optimization for the function.
	Document #pragma GCC option.  Document #pragma GCC optimize.

	* doc/options.texi (UInteger): Document UInteger must be used on
	options that that a flag word with a joined option like
	-falign-loops.

	* doc/tm.texi (TARGET_VALID_OPTION_ATTRIBUTE_P): Update
	documentation.
	(TARGET_OPTION_SAVE): Document new hook.
	(TARGET_OPTION_RESTORE): Ditto.
	(TARGET_OPTION_PRINT): Ditto.
	(TARGET_OPTION_PRAGMA_PARSE): Ditto.

	* tree.c (cl_optimization_node): New static node to build
	OPTIMIZATION_NODE's.
	(cl_target_option_node): New static node to build
	TARGET_OPTION_NODE's.
	(cl_option_hash_table): New static hash table to hold
	OPTIMIZATION_NODE and TARGET_OPTION_NODE's.
	(cl_option_hash_eq): New function for hashing OPTIMIZATION_NODE
	and TARGET_OPTION_NODE's.
	(cl_option_hash_hash): Ditto.
	(init_tree): Make the cl_optimization_node and
	cl_target_option_node.
	(build_optimization_node): New function to return a tree that
	includes all of the optimization options.
	(build_target_option_node): New function to return a tree that
	includes the target options that can be specified for target
	specific optimization.

	* tree.h (build_optimization_node): Add declaration.
	(build_target_option_node): Ditto.
	(enum tree_index): Add TI_OPTIMIZATION_HOT,
	TI_TARGET_OPTION_CURRENT, TI_CURRENT_OPTIMIZE_PRAGMA.
	(optimization_hot_node): New global_trees variable.
	(target_option_current_node): Ditto.
	(current_optimize_pragma): Ditto.

	* target.h (struct gcc_target): Add target_option_pragma_parse to
	implement #pragma GCC option.

	* toplev.h (parse_optimize_options): Add declaration.
	(fast_math_flags_struct_set_p): Ditto.

	* c-cppbuiltin.c (c_cpp_builtins_optimize_pragma): New function
	to adjust #defines after a #pragma GCC optimize.

	* opts.c (decode_options): Allow function to be called more than
	once to support attribute((optimize(...))).  Build initial
	optimization nodes.
	(fast_math_flags_struct_set_p): New function, analog of
	fast_math_flags_set_p, except take cl_optimization structure
	pointer instead of looking at global variables.

	* optc-gen.awk: Fix thinko in handling short fields.  Add some
	extra blank lines.

	* function.c (invoke_set_current_function_block): Update a
	comment.

	* c-pragma.c (handle_pragma_option): Allow optional ().  Change to
	use the target_option_pragma_parse hook.  Break some long lines.
	(optimize_stack): New VEC to track #pragma GCC optimize.
	(handle_pragma_optimize): Add #pragma GCC optimize support.
	(init_pragma): Register handle_pragma_optimize.

	* opth-gen.awk: Fix thinko in handling short fields.

	* common.opt (-O): Add Optimization specifier.
	(-Os): Ditto.
	(-falign-functions): Add UInteger option so field is stored as a
	full size int in the cl_optimization structure.  Add
	Optimization.
	(-falign-jumps): Ditto.
	(-falign-labels): Ditto.
	(-falign-loops): Ditto.
	(-fsched-stalled-insns): Ditto.
	(-fsched-stalled-insns-dep): Ditto.
	(-fmath-errno): Add Optimization option so that we can adjust
	__FINITE_MATH__ define in #pragma GCC optimize.

	* target-def.h (TARGET_OPTION_PRAGMA_PARSE): Add new hook.
	(TARGET_INITIALIZER): Add TARGET_OPTION_PRAGMA_PARSE.

	* tree-inline.c (tree_can_inline_p): Don't allow a function to
	inline a function with a higher optimization level than itself, or
	a different space/time tradeoff.

	* opt-functions.awk (var_type_struct): Move UInteger handling
	above Joined so the right type is returned.

	* c-common.c (handle_optimize_attribute): New attribute to
	handling setting optimization options.
	(c_common_attribute): Add "optimize" attribute.
	(handle_hot_attribute): Set optimization level to -O3.
	(handle_cold_attribute): Update setting optimization level to
	-Os.
	(optimize_args): New static vector for the command line arguments
	to attribute((optimize(...))).
	(parse_optimize_options): New function that is common code between
	attribute((optimize(...))) and #pragma GCC optimize to parse and
	set the optimization options.

	* c-common.h (c_cpp_builtins_optimize_pragma): Add declaration.
	(builtin_define_std): Ditto.

	* config.gcc (x86_64-*-darwin*): Make sure tmake_file includes
	previous tmake_file's.  Make sure c_target_objs includes previous
	c_target_objs.
	(i[34567]86-*-elf*): Ditto.
	(x86_64-*-elf*): Ditto.
	(i[34567]86-*-netbsd*): Ditto.
	(i[34567]86-*-openbsd2.*): Ditto.
	(i[34567]86-*openbsd3.[0123]): Ditto.
	(i[34567]86-pc-msdosdjgpp*): Ditto.
	(i[34567]86-*-lynxos*): Ditto.
	(i[3456x]86-*-netware*): Ditto.
	(i[34567]86-*-nto-qnx*): Ditto.
	(i[34567]86-*-rtems*): Ditto.
	(i[34567]86-*-solaris2*): Ditto.
	(i[34567]86-*-pe): Ditto.
	(i[34567]86-*-cygwin*): Ditto.
	(i[34567]86-*-mingw*): Ditto.
	(x86_64-*-mingw*): Ditto.
	(i[34567]86-*-interix3*): Ditto.
	(i[34567]86-*-linux*): Add i386/t-i386 as a new Makefile fragment.
	(x86_64-*-linux*): Ditto.
	(i[34567]86-*-*): Ditto.
	(x86_64-*-*): Ditto.

	* config/i386/i386.h (TARGET_CPU_CPP_BUILTINS): Move to
	ix86_target_macros.

	* config/i386/i386-c.c: New file for macro/preprocessor support.
	(ix86_target_macros_internal): New function to #define or #undef
	target specific macros.
	(ix86_target_macros): New function, set up all of the target
	macros like __SSE__.
	(ix86_function_specific_target_macros): New function to update the
	target macros based on the #pragma GCC option's used.

	* config/i386/t-i386: New file, add more dependencies for i386.o.
	Add new file i386-c.o.

	* config/i386/i386-protos.h (ix86_target_macros): Add declaration.
	(ix86_valid_option_attribute_tree): Ditto.

	* config/i386/i386.c (ix86_valid_option_attribute_tree): New
	function, split from ix86_valid_option_attribute_p, to be common
	code between attribute and pragma parsing.
	(ix86_valid_option_attribute_p): Move most of the code to
	ix86_valid_option_attribute_tree.
	(ix86_pragma_option_parse): New hook for #pragma GCC option
	support.
	(override_options): Use build_target_option_node to build the
	initial target option node.
	(ix86_function_specific_restore): Save some time if the arch or
	tune variables were not changed.
	(ix86_function_specific_print): Decode the target options.
	(ix86_insert_attributes): Delete, move #pragma GCC option handling
	into decl_attributes.
	(ix86_current_target): New static to remember the current target
	options.
	(ix86_previous_fndecl): New static to track last declaration
	passed to ix86_set_current_function.
	(ix86_set_current_function): Rewrite how the target options are
	set up and when to call target_reinit.  Use the current target
	options instead of the default options, so that #pragma GCC option
	works correctly.
	(ix86_init_builtins): Merge ix86_init_mmx_sse_builtins with this
	code, remove test for -mmmx.
	(ix86_init_mmx_sse_builtins): Merge into ix86_init_builtins.
	(TARGET_INSERT_ATTRIBUTES): Go back to the original code for
	machine dependent inserting attributes.

Merge up to 136900.

2008-06-17  Michael Meissner  <michael.meissner@amd.com>

	* doc/options.texi (TargetSave): Document new TargetSave flag to
	create declarations in the cl_target_option structure.
	(Save): Change structure name to cl_target_option from
	cl_option_save.

	* doc/extend.texi (#pragma GCC option): Document #pragma GCC
	option.

	* flags.h (optimize_for_space): Add declaration.

	* tree.c (tree_code_size): Support OPTIMIZATION_NODE and
	TARGET_OPTION_NODE tree structures.
	(tree_node_structure): Ditto.

	* tree.h (DECL_FUNCTION_SPECIFIC_TARGET): Rename from
	DECL_FUNCTION_SPECIFIC.
	(DECL_FUNCTION_SPECIFIC_OPTIMIZATION): New accessor macro.
	(struct tree_function_decl): Change function_specific_data to
	function_specific_target.  Add function_specific_optimization to
	point to the machine independent optimization fields.
	(struct tree_optimization_option): New tree structure to hold the
	machine independent optimization options.
	(TREE_OPTIMIZATION): New accessor macro.
	(struct tree_target_otpion): New tree structure to hold the target
	specific optins that can be changed on a per-function basis.
	(TREE_TARGET_OPTION): New acessor macro.
	(union tree_node): Add tree_optimization_option and
	tree_target_option fields.
	(enum tree_index): Add TI_OPTIMIZATION_DEFAULT,
	TI_OPTIMIZATION_CURRENT, TI_OPTIMIZATION_COLD,
	TI_TARGET_OPTION_DEFAULT, and TI_CURRENT_OPTION_PRAGMA.
	(optimization_default_node): Define as an element in
	global_trees.
	(optimization_current_node): Ditto.
	(optimization_cold_node): Ditto.
	(target_option_default_node): Ditto.
	(current_option_pragma): Ditto.

	* target.h (struct gcc_target): Add new hook functions,
	target_option_save, target_option_restore, target_option_print.

	* opts.c (optimize_for_space): New function, unset optimizations
	that tend to cause code bloat for turning -Os on in cold
	functions.
	(decode_options): Call optimze_for_space if -Os.  On the first
	call, save the current optimization options.

	* optc-gen.awk (flags.h): Include in options.c.
	(target.h): Ditto.
	(cl_optimization_save): Create new functions for saving,
	restoring, and printing optimization options.  Sort by the field
	size.  On the save, add gcc_asserts to make sure the value is not
	truncated.
	(cl_optimization_restore): Ditto.
	(cl_optimization_print): Ditto.
	(cl_target_option_save): Rename from cl_options_save and
	cl_options_restore.  If no 'Save' flag is used, just save and
	restore target_flags.  Sort by the field size.  On the save, add
	gcc_asserts to make sure the value is not truncated.  Call target
	hooks to save/restore other values.

	* opth-gen.awk (struct cl_optimization): New structure that is
	created to remember all optimization options.  Compress fields to
	unsigned char to save space if it is safe.  Sort fields by size.
	(struct cl_target_option): Rename from cl_option_save.  Compress
	fields to unsigned char to save space if is safe.  Sort fields by
	size.  Add support for TargetSafe to store additional fields.

	* opt-functions.awk (var_type_struct): New function to return
	appropriate type for the cl_target_option and cl_optimization
	structures.

	* treestruct.def (TS_OPTIMIZATION): New tree structure for saving
	optimization options.
	(TS_TARGET_OPTION): New tree structure for saving target specific
	options.

	* function.c (invoke_set_current_function_hook): If the function
	has different optimization options, switch to use the options.

	* coretypes.h (struct cl_option_save): Delete.
	(struct function_specific_data): Ditto.
	(struct cl_target_option): Add forward declaration.
	(struct cl_optimization): Ditto.

	* c-pragma.c (option_stack): New vector of trees to implement
	#pragma GCC option [push|pop].
	(handle_pragma_option): Add support for #pragma GCC option.
	(init_pragma): Ditto.

	* tree.def (OPTIMIZATION_NODE): New tree node.
	(TARGET_OPTION_NODE): Ditto.

	* print-tree.c (print_node): Add support for OPTIMIZATION_NODE and
	TARGET_OPTION_NODE.

	* target-def.h (TARGET_OPTION_SAVE): New hook function.
	(TARGET_OPTION_RESTORE): Ditto.
	(TARGET_OPTION_PRINT): Ditto.
	(TARGET_INITIALIZER): Add new hooks.

	* c-common.c (handle_cold_attribute): If cold function, and
	-O2/-O3, turn on -Os for this one function.

	* Makefile (TREE_H): Add options.h.
	(options.o): Add $(TARGET_H) and $(FLAGS_H) dependencies.

	* config/i386/i386.h (TARGET_VALID_OPTION_ATTRIBUTE_P): Move to
	i386.c since it doesn't need to be global.
	(TARGET_SET_CURRENT_FUNCTION): Ditto.
	(struct function_specific_data): Delete, contents moved into
	cl_target_option structure.

	* config/i386/i386.opt (arch): New field to be saved in the
	cl_target_option structure.
	(tune): Ditto.
	(fpmath): Ditto.
	(branch_cost): Ditto.
	(ix86_isa_flags_explicit): Ditto.
	(tune_defaulted): Ditto.
	(arch_specified): Ditto.

	* config/i386/i386.c (ix86_function_specific_save): Make a hook
	function called from cl_target_option_save.
	(ix86_function_specific_restore): Make a hook function called from
	cl_target_option_restore.
	(ix86_function_specific_print): New hook function to be called
	from cl_target_option_print.
	(ix86_insert_attributes): New function to insert #pragma GCC
	option attributes.  If SUBTARGET_INSERT_ATTRIBUTES is defined,
	call it.
	(ix86_initial_options): Delete, use new global tree
	function_specific_default_node.
	(override_options): Save the default target options in
	target_option_default_node.
	(ix86_valid_option_attribute_p): Switch to having target options
	in trees.  Allow fndecl to be NULL when parsing #pragma.
	(ix86_can_inline_p): Switch to having target options in trees.
	(ix86_set_current_function): Ditto.
	(TARGET_INSERT_ATTRIBUTES): Call ix86_insert_attributes.
	(TARGET_VALID_OPTION_ATTRIBUTE_P): Move here from i386.h.
	(TARGET_SET_CURRENT_FUNCTION): Ditto.
	(TARGET_CAN_INLINE_P): Ditto.
	(TARGET_OPTION_SAVE): Call ix86_function_specific_save.
	(TARGET_OPTION_RESTORE): Call ix86_function_specific_restore.
	(TARGET_OPTION_PRINT): Call ix86_function_specific_print.

Merge up to 136713.  Merge up to patches submitted to gcc-patches.  The
following log entry is from the patch submission.

2008-06-11  Michael Meissner  <michael.meissner@amd.com>
	    Karthik Kumar  <karthikkumar@gmail.com>

	* opth-gen.awk: Add support for a 'Save' flag which says to give
	the port a way to save and preserve selected command line
	options.  Do not emit the same declaration more than once.

	* optc-gen.awk: If a 'Save' flag is used, create the
	cl_options_save and cl_options_restore to save/restore the
	selected options.

	* targhooks.c (default_can_inline_p): New default function to
	determine if one function can inline another.

	* targhooks.h (default_can_inline_p): Add declaration.

	* tree.h (struct tree_function_decl): New field for target
	specific options.
	(DECL_FUNCTION_SPECIFIC): New accessor macro.

	* target.h (struct gcc_target): Add valid_option_attribute_p and
	can_inline_p hooks.

	* ipa-inline.c (cgraph_decide_inlining_of_small_function): Call
	tree_can_inline_p to determine if it is ok to inline, and set
	CALL_STMT_CANNOT_INLINE_P to true if not.
	(cgraph_decide_inlining): Ditto.
	(cgraph_decide_inlining_incrementally): Ditto.

	* c-decl.c (merge_decls): If there are function specific options,
	copy them to the new declaration.

	* coretypes.h (struct cl_option_save): Add forward declaration.
	(struct function_specific_data): Ditto.

	* print-tree.c (print_node): Print out of the
	DECL_FUNCTION_SPECIFIC field is non-null.

	* target-def.h (TARGET_VALID_OPTION_ATTRIBUTE_P): New hook for
	parsing attribute(option(...)).
	(TARGET_CAN_INLINE_P): New hook to determine if one function can
	inline another.
	(TARGET_INITIALIZER): Add new hooks.

	* tree-inline.c (tree_can_inline_p): New hook to call the target
	hook to determine if one function can inline another.

	* tree-inline.h (tree_can_inline_p): Add declaration.

	* c-common.c (handle_option_attribute): New function to handle
	attribute((option(...))).
	(c_common_attribute): Add attribute((option(...))) support.

	* config/i386/i386.h (TARGET_ABM): Change to use ix86_isa_flags
	mask instead of a separate variable.
	(TARGET_POPCNT): Ditto.
	(TARGET_CMPXCHG16B): Ditto.
	(TARGET_SAHF): Ditto.
	(TARGET_AES): Ditto.
	(TARGET_PCLMUL): Ditto.
	(TARGET_RECIP): Delete, now generated in options.h.
	(TARGET_FUSED_MADD): Ditto.
	(ix86_isa_flags2): Add declaration.
	(ix86_tune_features): Change type to unsigned char.
	(ix86_arch_features): Ditto.
	(OVERRIDE_OPTIONS): Add argument to indicate this is the initial
	call.
	(TARGET_VALID_OPTION_ATTRIBUTE_P): Define hook.
	(TARGET_CAN_INLINE_P): Ditto.
	(TARGET_SET_CURRENT_FUNCTION): Ditto.
	(struct machine_option_attr): New structure to hold bits needed
	for target specific options that aren't part of the options.
	(struct function_specific_data): New structure to hold all of the
	state needed for target specific options.

	* config/i386/i386.opt: For all options that use target_flags or
	ix86_isa_flags, add 'Save' to save these flags for target specific
	optimizations.
	(-mrecip): Move into target_flags.
	(-mfused-madd): Ditto.
	(-mabm): Change to use ix86_isa2_flags mask instead of a separate
	variable.  Allow -mno-<switch> for symmetry.
	(-mcx16): Ditto.
	(-mpopcnt): Ditto.
	(-msahf): Ditto.
	(-maes): Ditto.
	(-mpclmul): Ditto.

	* config/i386/i386-protos.h (override_options): Add bool argument.

	* config/i386/i386.c (ix86_tune_features): Make type unsigned
	char.  Move processor masks to initial_ix86_tune_features.
	(initial_ix86_tune_features): Move tune processor masks here.
	(ix86_arch_features): Make type unsigned char.  Move processor
	masks to initial_ix86_arch_features.
	(initial_ix86_arch_features): Move arch processor masks here.
	(OPTION_MASK_ISA_AES_SET): Make abm, popcnt, cmpxchg16b, sahf,
	aes, pclmul options isa options and define set and unset macros.
	(OPTION_MASK_ISA_PCLMUL_SET): Ditto.
	(OPTION_MASK_ISA_ABM_SET): Ditto.
	(OPTION_MASK_ISA_POPCNT_SET): Ditto.
	(OPTION_MASK_ISA_CX16): Ditto.
	(OPTION_MASK_ISA_SAHF): Ditto.
	(OPTION_MASK_ISA_AES_UNSET): Ditto.
	(OPTION_MASK_ISA_PCLMUL_UNSET): Ditto.
	(OPTION_MASK_ISA_ABM_UNSET): Ditto.
	(OPTION_MASK_ISA_POPCNT_UNSET): Ditto.
	(OPTION_MASK_ISA_UNCX16): Ditto.
	(OPTION_MASK_ISA_UNSAHF): Ditto.
	(ix86_handle_option): Ditto.
	(enum ix86_target_specific_strings): New enumeration to track the
	string arguments used with target specific options.
	(ix86_target_string): New function to return a string that
	describes a set of options.
	(ix86_debug_options): New function that is callable from the debug
	to print the options.
	(ix86_function_specific_save): New function to save the current
	target specific options into a structure.
	(ix86_function_specific_restore): New function to restore the
	target specific options to the option global variables.
	(ix86_valid_option_attribute_p): Function to validate
	attribute((option(...))).
	(ix86_valid_option_attribute_inner_p): Inner function for
	ix86_valid_option_attribute_p.
	(ix86_can_inline_p): New function to determine if one function can
	inline another function, based on the target specific options.
	(ix86_initial_options): Hold a copy of the initial options.
	(ix86_isa_flags_explicit): Make global, not static.
	(ix86_tune_defaulted): Move to file scope from override_options.
	(ix86_arch_specified): Ditto.
	(struct ptt): Ditto.
	(processor_target_table): Ditto.
	(cpu_names): Ditto.
	(override_options): Add argument to say whether this is for the
	main options, or attribute((option(...))).  Move struct ptt,
	processor_target_table, and cpu_names to file scope.  Change the
	error messages so the appropriate message is printed on global
	options or target specific options.  Support -mfpmath=sse+387 and
	-mfpmath=both as synonyms for -mfpmath=sse,387.
	(ix86_builtins_isa): New static array to track which ISA a builtin
	requires.
	(def_builtin): Always create the declaration for a builtin
	function, except for 64-bit builtins in 32-bit.  Save away the isa
	needed in ix86_builtins_isa for checking when the builtin is
	expanded.
	(ix86_init_mmx_sse_builtins): Always call def_builtin_const to
	define AES and PCLMUL builtins.
	(ix86_expand_builtin): Check whether a builtin function is legal
	for the ISA of the current function.

	* doc/options.texi (Save): Document new option flag.

	* doc/extend.texi (function attributes): Document
	attribute((option(...))).

	* doc/invoke.texi (-mfpmath): Document that -mfpmath=both and
	-mfpmath=sse+387 are allowed along with -mfpmath=sse,387.

	* doc/c-tree.texi (DECL_FUNCTION_SPECIFIC): Document new accessor
	macro for function specific support.

	* doc/tm.texi (TARGET_VALID_OPTION_ATTRIBUTE_P): Document new hook
	to parse attribute((option(...))).
	(TARGET_CAN_INLINE_P): Document new hook to determine if one
	function can inline another.

========================================================
	
2008-06-06  Michael Meissner  <michael.meissner@amd.com>

	* opth-gen.awk: Do not generate function declarations for the
	save, restore functions if inside the gcc driver.

	* optc-gen.awk: Do not generate the save, restore functions inside
	the gcc driver.

	* config/i386/i386.h (TARGET_ABM): Change to use ix86_isa_flags
	mask instead of a separate variable.
	(TARGET_POPCNT): Ditto.
	(TARGET_CMPXCHG16B): Ditto.
	(TARGET_SAHF): Ditto.
	(TARGET_AES): Ditto.
	(TARGET_PCLMUL): Ditto.
	(TARGET_RECIP): Delete, now generated in options.h.
	(TARGET_FUSED_MADD): Ditto.
	(ix86_isa_flags): Add the declaration back in.

	* config/i386/i386.opt (-mrecip): Move into target_flags.
	(-mfused-madd): Ditto.
	(-mabm): Change to use ix86_isa2_flags mask instead of a separate
	variable.  Allow -mno-<switch> for symmetry.
	(-mcx16): Ditto.
	(-mpopcnt): Ditto.
	(-msahf): Ditto.
	(-maes): Ditto.
	(-mpclmul): Ditto.

	* config/i386/i386.c (OPTION_MASK_ISA_AES_SET): Make abm, popcnt,
	cmpxchg16b, sahf, aes, pclmul options isa options and define set
	and unset macros.
	(OPTION_MASK_ISA_PCLMUL_SET): Ditto.
	(OPTION_MASK_ISA_ABM_SET): Ditto.
	(OPTION_MASK_ISA_POPCNT_SET): Ditto.
	(OPTION_MASK_ISA_CX16): Ditto.
	(OPTION_MASK_ISA_SAHF): Ditto.
	(OPTION_MASK_ISA_AES_UNSET): Ditto.
	(OPTION_MASK_ISA_PCLMUL_UNSET): Ditto.
	(OPTION_MASK_ISA_ABM_UNSET): Ditto.
	(OPTION_MASK_ISA_POPCNT_UNSET): Ditto.
	(OPTION_MASK_ISA_UNCX16): Ditto.
	(OPTION_MASK_ISA_UNSAHF): Ditto.
	(ix86_handle_option): Ditto.
	(override_options): Ditto.
	(ix86_valid_option_attribute_inner_p): Change calling sequence to
	process just one argument.
	(ix86_option_count_args): Delete.
	(ix86_option_build_args): Ditto.
	(ix86_valid_option_attribute_p): Move the processing before and
	after the argument here from ix86_valid_option_attribute_inner_p.
	(ix86_can_inline_p): Allow callee to be a subset of the caller's
	ISA options, for example, SSE5 can inline SSE2 functions.

2008-06-05  Michael Meissner  <michael.meissner@amd.com>

	* targhooks.c (default_can_inline_p): Move default hook here from
	target-specific.c and rename it.

	* targhooks.h (default_can_inline_p): Rename from
	default_target_specific_can_inline_p.

	* tree.h (DECL_FUNCTION_SPECIFIC): Rename from
	DECL_TARGET_SPECIFIC.
	(struct tree_function_decl): Rename target_specific field to
	function_specific.
	(handle_option_attribute): Delete declaration.

	* target.h (struct target_specific_hooks): Delete.
	(struct gcc_target): Replace target_specific hook with
	valid_option_attribute_p and can_inline_p hooks.  Change calling
	sequence on valid_option_attribute_p to more closely match the
	attribute calling sequence.

	* target-specific.c: Delete file, move functions to targhooks.c
	and c-common.c.

	* ipa-inline.c (cgraph_decide_inlining_of_small_function): Change
	tree_target_specific_can_inline_p to tree_can_inline_p.
	(cgraph_decide_inlining): Ditto.
	(cgraph_decide_inlining_incrementally): Ditto.

	* c-decl.c (merge_decls): Rename DECL_TARGET_SPECIFIC to
	DECL_FUNCTION_SPECIFIC. 

	* coretypes.h (struct function_specific_data): Rename from
	target_specific_data.

	* print-tree.c (print_node): Rename DECL_TARGET_SPECIFIC to
	DECL_FUNCTION_SPECIFIC.

	* target-def.h (TARGET_VALID_OPTION_ATTRIBUTE_P): Rename from
	TARGET_TARGET_SPECIFIC_VALIDATE.
	(TARGET_CAN_INLINE_P): Rename from
	TARGET_TARGET_SPECIFIC_CAN_INLINE_P.
	(TARGET_TARGET_SPECIFIC): Delete.
	(TARGET_INITIALIZER): Delete TARGET_TARGET_SPECIFIC, use
	TARGET_VALID_OPTION_ATTRIBUTE_P and TARGET_CAN_INLINE_P.

	* tree-inline.c (tree_can_inline_p): Rename from
	tree_target_specific_can_inline_p.

	* tree-inline.h (tree_can_inline_p): Rename from
	tree_target_specific_can_inline_p.

	* c-common.c (c_common_attribute_table): Remove FIXME comment on
	"option" attribute, and move it to the end.
	(handle_option_attribute): Move this here from target-specific.c
	and change the calling sequence of the backend hook.

	* Makefile.in (OBJS-common): Delete target-specific.o.
	(target-specific.o): Delete.

	* config/i386/i386.h (TARGET_VALID_OPTION_ATTRIBUTE_P): Rename
	from TARGET_TARGET_SPECIFIC_VALIDATE.
	(TARGET_CAN_INLINE_P): Rename from
	TARGET_TARGET_SPECIFIC_CAN_INLINE_P.
	(struct function_specific_data): Rename from
	target_specific_data.

	* config/i386/i386.c (ix86_function_specific_save): Rename from
	ix86_target_specific_save.  Change callers.
	(ix86_function_specific_restore): Rename from
	ix86_target_specific_save.  Change callers.
	(ix86_can_inline_p): Rename from
	ix86_target_specific_can_inline_p.
	(ix86_valid_option_attribute_p): New function that is called from
	handle_option_attribute, and has the new calling sequence.
	(ix86_valid_option_attribute_inner_p): Rename from
	ix86_target_specific_validate.  Change DECL_TARGET_SPECIFIC to
	DECL_FUNCTION_SPECIFIC.
	(ix86_option_count_args): Move from target-specific.c and rename
	from target_specific_count_args.
	(ix86_option_build_args): Move from target-specific.c and rename
	from target_specific_build_args.
	(ix86_can_inline_p): Rename from ix86_target_specific_can_inline_p
	and change other target specific -> function specific references.

2008-06-05  Michael Meissner  <michael.meissner@amd.com>

	* doc/options.texi: Port changes from mainline patch
	http://gcc.gnu.org/ml/gcc-patches/2008-06/msg00277.html.
	* optc-gen.awk: Ditto.
	* opth-gen.awk: Ditto.
	
	* rtlanal.c (target_flags): Undo 4/11 change.

	* gensupport.c (target_flags): Undo 4/11 change.

	* toplev.c (target_flags_explicit): Undo 4/11 change.

	* config/i386/i386.c (ix86_target_specific_save): Rename save
	function to cl_options_save.
	(ix86_target_specific_restore): Rename restore function to
	cl_options_restore.
	
	* optc-gen.awk: Change cl_option_attr structure name to
	cl_option_save.  Add support 'Explicit' which builds a
	<var>_explicit variable as well as <var>.
	* opth-gen.awk: Ditto.

	* coretypes.h (struct cl_option_save): Rename from
	cl_option_attr.

	* config/i386/i386.h (struct machine_option_attr): Remove
	isa_flags_explicit.
	(struct target_specific_data): Rename struct cl_option_attr to
	cl_option_save.

	* config/i386/i386.opt (ix86_isa_flags): Add Explicit tag.

	* config/i386/i386.c (ix86_isa_flags_explicit): Delete, now
	created in options.c.
	(ix86_target_specific_save): Delete ix86_isa_flags_explicit
	reference.
	(ix86_target_specific_restore): Ditto.

2008-06-04  Michael Meissner  <michael.meissner@amd.com>

	* doc/tm.texi (Per-Function Data): Document
	TARGET_TARGET_SPECIFIC_VALIDATE,
	TARGET_TARGET_SPECIFIC_CAN_INLINE_P.
	(Misc): Document struct target_specific_data.

	* doc/c-tree.texi (Function Basics): Add documentation of
	DECL_TARGET_SPECIFIC.

	* config/i386/i386.c (ix86_target_string): New function to return
	a string with the various machine dependent options.
	(ix86_debug_options): Remove DEBUG_TARGET_SPECIFIC and make it
	have the unused attribute so it can be called from the debugger.
	(override_options): Remove debug code.
	(ix86_target_specific_validate): Ditto.
	(ix86_set_current_function): Ditto.
	(ix86_builtins_isa): New static array to record the isa options
	needed for a builtin.
	(def_builtin): Add declarations for all builtins, except for
	64-bit specific builtins on 32-bit to allow for target specfic
	functions to call builtins that aren't available with the normal
	compilation switches.
	(ix86_expand_builtin): Check whether the builtin function is
	applicable for the current ISA and complain if it isn't.

2008-06-02  Michael Meissner  <michael.meissner@amd.com>

	* opts-common.c (find_opt): Undo size_t to unsigned long change.

	* tree.h (opts.h): Undo change to include opts.h.

	* tree-pass.h (pass_push_set_options): Delete, no longer used.
	(pass_pop_options): Ditto.

	* target.h (struct target_specific_hooks): Rename from
	target_specfic.

	* target-specific.c (handle_option_attribute): Remove #ifdef to
	see if we have function specific options, just look at the
	validate hook.

	* ipa-inline.c (cgraph_decide_inlining_of_small_function): Use
	CALL_STMT_CANNOT_INLINE_P, not CALL_CANNOT_INLINE_P.
	(cgraph_decide_inlining): Ditto.
	(cgraph_decide_inlining_incrementally): Ditto.
	(cgraph_decide_inlining_incrementally): Move target hook check a
	little later.

	* opts.c (no_unit_at_a_time_default): Undo bool to int change.
	(handle_option): Undo change to make this global and add an
	argument for checking attribute arguments.
	(handle_options): Remove 3rd argument to handle_option.
	(decode_options): Remove call to initialize_attribute_options.
	(option_enable): Undo bool to int type change.
	(get_option_state): Ditto.

	* opts.h (union cl_option_stor): Delete, no longer used.
	(cl_option_storp): Ditto.
	(cl_option_stors_count): Ditto.
	(cl_option_stors): Ditto.
	(struct cl_option): Undo size_t to long unsigned type change.
	(CL_PARAMS): Undo change to unsigned for bitmask.
	(CL_WARNING): Ditto.
	(CL_OPTIMIZATION): Ditto.
	(CL_TARGET): Ditto.
	(CL_COMMON): Ditto.
	(CL_DISABLED): Ditto.
	(CL_REPORT): Ditto.
	(CL_JOINED): Ditto.
	(CL_SEPARATE): Ditto.
	(CL_REJECT_NEGATIVE): Ditto.
	(CL_MISSING_OK): Ditto.
	(CL_UINTEGER): Ditto.
	(CL_UNDOCUMENTED): Ditto.
	(CL_ATTRIBUTE): Delete, no longer used.
	(find_opt): Undo size_to to unsigned long type change.
	(get_option_state): Undo bool to int type change.
	(handle_option): Delete declaration.

	* opth-gen.awk: Change from using Attribute to Save to better
	reflect the usage.  If the port declared no options with Save,
	just save target_flags and target_flags_explicit.  Do not define
	HAVE_TARGET_SPECIFIC. 
	* optc-gen.awk: Ditto.

	* opt-functions.awk (switch_flags): Don't set CL_ATTRIBUTE.

	* Makefile.in (TREE_H): Do not include opts.h.

	* config/i386/i386.opt (ix86_arch_string): Remove attribute
	declaration.
	(ix86_tune_string): Ditto.
	(ix86_fpmath_string): Ditto.
	(ix86_isa_flags): Change Attribute to Save.
	(ix86_extra_flags): Ditto.

	* config/i386/i386-protos.h (ix86_target_specific_validate):
	Remove delcaration, make static.
	(ix86_target_specific_can_inline_p): Ditto.

	* config/i386/i386.c (ix86_target_specific_validate): Make
	static.
	(ix86_target_specific_can_inline_p): Ditto.
	(ix86_set_current_function): Ditto.
	
2008-05-30  Michael Meissner  <michael.meissner@amd.com>

	* Sync up to 136210.

2008-05-29  Michael Meissner  <michael.meissner@amd.com>

	* tree.h (DECL_TARGET_SPECIFIC): New accessor macro.
	(struct function_decl): Add target_specific field.

	* target.h (struct target_specific): Delete push_options and
	pop_options hook.  Add validate hook.

	* toplev.c (process_options): Delete preserving target specific
	options.
	(toplev_main): Delete initialize_attribute_options call.

	* target-specific.c (struct cl_attr_stack): Delete stacking and
	saving options.
	(cl_option_top): Ditto.
	(target_specific_push): Delete.
	(target_specific_pop): Ditto.
	(driver_push_set_options): Ditto.
	(driver_pop_options): Ditto.
	(target_specific_qsort): Ditto.
	(target_specific_count_args): Simplify, remove counting string
	size.
	(target_specific_build_args): Rewrite, make caller allocate argv
	array.
	(handle_option_attribute): Change to use validate hook.  Add ifdef
	in case port does not support target specific options.  Change to
	new calling sequence of target_specific_build_args.
	(default_target_specific_can_inline_p): Only check whether the
	target specific pointer is the same or not.
	(pass_push_set_options): Delete, change to use set current
	function hook.
	(pass_pop_options): Ditto.

	* ipa-inline.c (cgraph_decide_inling_of_small_function): Set
	CALL_CANNOT_INLINE_P if the target specific option hook indicates
	we should not inline the functions.
	(cgraph_decide_inling_incrementally): Ditto.

	* opts.h (initialize_attribute_options): Delete.

	* optc-gen.awk: Rewrite attribute support so we provide functions
	to save/restore the attributes instead of a global structure.
	* opth-gen.awk: Ditto.

	* c-decl.c (merge_decls): Merge target specific data.

	* coretypes.h (struct cl_option_attr): Add forward reference.
	(struct target_specific_data): Ditto.

	* print-tree.c (print_node): Print out if the function has target
	specific data.

	* common.opt (-falign-functions): Remove option Attribute.
	(-falign-functions=): Ditto.
	(-falign-jumps): Ditto.
	(-falign-jumps=): Ditto.
	(-falign-labels): Ditto.
	(-falign-labels=): Ditto.
	(-falign-loops): Ditto.
	(-falign-loops=): Ditto.

	* target-def.h (TARGET_TARGET_SPECIFIC_PUSH): Delete.
	(TARGET_TARGET_SPECIFIC_POP): Ditto.
	(TARGET_TARGET_SPECIFIC_VALIDATE): New hook.
	(TARGET_TARGET_SPECIFIC): Update hooks.

	* passes.c (pass_rest_of_compilation): Remove
	pass_push_set_options and pass_pop_options.

	* config/i386/i386.h (TARGET_TARGET_SPECIFIC_PUSH): Delete.
	(TARGET_TARGET_SPECIFIC_POP): Ditto.
	(TARGET_TARGET_SPECIFIC_VALIDATE): Define to
	ix86_target_specific_validate.
	(struct machine_function): Delete unused fields added previously.
	(struct machine_option_attr): New structure to collect target
	specific information not in the cl_option_attr structure.
	(struct targe_specific_data): Collect all of the target specific
	data in one place.

	* config/i386/i386.opt (-mfpmath=): Make attribute option.
	(-mabm): Add VarExists.

	* config/i386/i386-protos.h (ix86_target_specific_push): Delete.
	(ix86_target_specific_pop): Ditto.
	(ix86_target_specific_validate): New declaration.

	* config/i386/i386.c (ix86_target_specific_save): New function to
	save target specific options.
	(ix86_target_specific_restore): New function to restore target
	specific options.
	(struct ptt): Move to toplevel from override_options.
	(processor_target_table): Ditto.
	(ix86_tune_defaulted): Ditto.
	(ix86_arch_specified): Ditto.
	(cpu_names): Ditto.
	(ix86_debug_option): Temporary debug function.
	(override_options): Improve error message for attribute(option).
	Save current options if this is the main function.
	(ix86_target_specific_validate): New function to validate
	attribute(option).
	(ix86_target_specific_push): Delete.
	(ix86_target_specific_pop): Ditto.
	(ix86_target_specific_can_inline_p): New function, validate
	whether one function can inline another.
	(ix86_set_current_function): Rewrite to properly switch options.
	
2008-05-23  Michael Meissner  <michael.meissner@amd.com>

	* target.h (struct target_specific): Change can_inline_p hook to
	take caller and callee argument instead of one argument.

	* target-specific.c (default_target_specific_can_inline_p):
	Rewrite to consider the caller and callee, and allow a caller to
	inline a callee that has the same target specific options.

	* ipa-inline.c (cgraph_decide_inlining_of_small_function): Call
	tree_target_specific_can_inline_p to determine if one function can
	inline another due to target specific options.
	(cgraph_decide_inlining): Ditto.
	(cgraph_decide_inlining_incrementally): Ditto.

	* tree-inline.c (inlinable_function_p): Remove call for target
	specific can_inline_p hook here, move it to ipa-inline.c.
	(tree_target_specific_can_inline_p): New function to call the
	target hook to determine if one function can inline another in a
	target specfic fashion.

	* tree-inline.h (tree_target_specific_can_inline_p): Add
	declaration.

	* config/i386/i386.h (TARGET_ABM): Make -mabm, -mpopcnt, -mcx16,
	-maes, -mpclmul ISA options rather than using unique variables.
	(TARGET_POPCNT): Ditto.
	(TARGET_CX16): Ditto.
	(TARGET_AES): Ditto.
	(TARGET_PCLMUL): Ditto.
	(TARGET_SAHF): Move -msahf, -mrecip, -mfused-madd into extra
	options, instead of using unique variables.
	(TARGET_RECIP): Ditto.
	(TARGET_FUSED_MADD): Ditto.
	(ix86_tune_features): Change type to unsigned char.
	(ix86_arch_features): Ditto.
	(struct machine_function): Add fields for remembering the ISA and
	other options used to compile a given function.

	* config/i386/i386.opt (mabm): Make -mabm, -mpopcnt, -mcx16,
	-maes, -mpclmul ISA options rather than using unique variables.
	(mpopcnt): Ditto.
	(mcx16): Ditto.
	(maes): Ditto.
	(mpclmul): Ditto.
	(msahf): Move -msahf, -mrecip, -mfused-madd into extra options,
	instead of using unique variables.

	* config/i386/i386.c (ix86_tune_features): Change type to unsigned
	char.
	(ix86_arch_features): Ditto.
	(OPTION_MASK_ISA_SSE4A_SET): Add popcnt, abm to sse4a.
	(override_options): Change initialization of ix86_tune_features
	and ix86_arch_features.  Make -mabm, -mpopcnt, -mcx16, -maes,
	-mpclmul ISA options rather than using unique variables.  Move
	-msahf, -mrecip, -mfused-madd into extra options, instead of using
	unique variables.

2008-05-22  Michael Meissner  <michael.meissner@amd.com>

	* config/i386/i386-protos.h (ix86_set_current_function): Declare.

	* config/i386/i386.c (override_options): White space changes.
	(ix86_target_specific_push): If arch changed but not tune, update
	tune string also.
	(ix86_set_current_function): New function, stub for now.

	* config/i386/i386.h (TARGET_SET_CURRENT_FUNCTION): Define, call
	ix86_set_current_function.

2008-05-18  Michael Meissner  <michael.meissner@amd.com>

	* ammintrin.h: Undo 2008-04-21 changes adding machine specific
	option attributes, since this now prevents inlining.
	* bmmintrin.h: Ditto.
	* emmintrin.h: Ditto.
	* mmintrin-common.h: Ditto.
	* mmintrin.h: Ditto.
	* smmintrin.h: Ditto.
	* tmmintrin.h: Ditto.
	* xmmintrin.h: Ditto.
	* mm3dnow.h: Ditto.

2008-05-17  Michael Meissner  <michael.meissner@amd.com>

	* config/i386/i386.c (override_options): Move code around to be
	C90 compliant.

	* target.h (struct target_specific): Change can_inline_p to take
	only one argument.

	* target-specific.c (cl_option_args): Rewrite how arguments are
	built.
	(MIN_ALLOC_ARGS): Delete.
	(STRING_POOL_SIZE): Ditto.
	(target_specific_count_args): New function to count arguments.
	(target_specific_build_args_internal): New worker function to
	build the argument vector.
	(target_specific_build_args): Rewrite building arguments.  Rename
	from target_specific_build_arguments, change callers.
	(target_specific_free_args): Rename from
	target_specific_free_arguments.
	(target_specific_qsort): Convert pointers to const char **.
	(target_specific_push): Argv is now const char **.
	(driver_push_set_options): Change how argv vector is built.
	(handle_option_attribute): Ditto.
	(default_target_specific_can_inline_p): Change function to take
	only one argument, and return false if the function has target
	specific options.

	* tree-inline.c (inlinable_function_p): Change call to target
	specific hook to just look at the function itself, since we don't
	have the caller at this point.

	* targhooks.h (default_target_specific_can_inline_p): Change
	calling signature.

2008-05-16  Michael Meissner  <michael.meissner@amd.com>

	* tree-inline.c (inlinable_function_p): Call the target specfic
	backend hook to determine if it is safe to inline a function.

	* targhooks.c (default_target_specific_can_inline_p): Add default
	version to prevent functions with target specific options from
	being inlined.

	* target-def.h (TARGET_TARGET_SPECIFIC_CAN_INLINE_P): Change
	default to default_target_specific_can_inline_p.

	* target.h (struct target_specific): Change signature of
	can_inline_p function from tree to const_tree.

	* config/i386/i386.c (override_options): Fix up error messages, so
	it correctly complains about -mxxx or option("xxx").
	(ix86_target_specific_push): Move restoring string opts to the
	push function from the pop function.
	(ix86_target_specific_pop): Ditto.

	* tree.h (handle_option_attribute): Add declaration.

	* tree-opt.c: Delete file.  Rename to target-specific.c.

	* target-specific.c: New file, renamed from tree-opt.c.
	(target_specific_push): Moved from opts-common.c, make static.
	Rename from push_attribute_options.  Call target backend hook.
	Create argv with '-' prepended.
	(target_specific_pop): Moved from opts-common.c, make static.
	Rename from pop_attribute_options.  Call target backend hook.
	(cl_option_stor_stack): Moved from opts-common.c, make static.
	(cl_option_stor_stack): Ditto.
	(handle_option_attribute): Moved from c-common.c, make static.
	(target_specific_build_arguments): New function to build argc,
	argv for arguments.
	(target_specific_free_arguments): New function to release memory
	allocated via target_specific_build_arguments.
	(cl_option_top): Renamed from top.
	(default_target_specific_can_inline_p): Add default version to
	restrict inlining of target specific functions with different
	options.
	(targhooks.h): Include for default_target_specific_can_inline_p.
	(default_target_specific_can_inline_p): New function to determine
	if one function can inline another based on the target specific
	options.
	(target_specific_qsort): New function to sort char * array.

	* c-common.c (handle_option_attribute): Move to target-specific.c.

	* Makefile.in (target-specific.o): Rename from tree-opt.o.  Add
	gt-targhooks.h dependency.

	* config/i386/i386.c (ix86_string_ops): Add initial '-'.
	(ix86_target_specific_push): Eliminate adding '-', since our
	caller now does this.

	* opts-common.c (cl_option_stors_stack): Move to
	target-specific.c.
	(push_attribute_options): Ditto.
	(pop_attribute_options): Ditto.

	* opts.h (push_attribute_options): Change calling signature.

	* c-common.c (handle_option_attribute): Remove call to target
	backend hooks, since the push/pop attribute functions now call
	them.

2008-05-15  Michael Meissner  <michael.meissner@amd.com>

	* target.h (struct target_specific): New structure to gather
	target specific hooks.
	(struct gcc_target): Add target_specific field.

	* target-def.h (TARGET_TARGET_SPECIFIC_PUSH): New macro for
	backend hook for target specific options.
	(TARGET_TARGET_SPECIFIC_POP): Ditto.
	(TARGET_TARGET_SPECIFIC_CAN_INLINE_P): Ditto.
	(TARGET_TARGET_SPECIFIC): Ditto.
	(TARGET_INITIALIZER): Add TARGET_TARGET_SPECIFIC.

	* tree-opt.c (driver_push_set_options): Rewrite to use target
	specific hooks.
	(driver_pop_options): Ditto.

	* c-common.c (handle_option_attribute): Give an error if the
	machine doesn't support target specific options.  Parse the
	options when declared by doing push/pop.

	* config/i386/i386.h (TARGET_TARGET_SPECIFIC_PUSH): Define target
	specific backend hooks.
	(TARGET_TARGET_SPECIFIC_POP): Ditto.
	(TARGET_SPECIFIC_INIT): Delete.
	(TARGET_SPECIFIC_PUSH): Ditto.
	(TARGET_SPECIFIC_POP): Ditto.
	(TARGET_SPECIFIC_OPTION): Ditto.

	* config/i386/i386.c (ix86_target_specific_init): Delete.
	(ix86_target_specific_option): Ditto.
	(ix86_target_specific_push): Change to be a target hook.
	(ix86_target_specific_pop): Ditto.

	* config/i386/i386-protos.h (ix86_target_specific_init): Delete.
	(ix86_target_specific_option): Ditto.
	(ix86_target_specific_push): Change to be a target hook.
	(ix86_target_specific_pop): Ditto.

2008-05-15  Michael Meissner  <michael.meissner@amd.com>
	    Karthik Kumar  <karthikkumar@gmail.com>

	* tree-opt.c (driver_push_set_options): Require the backend to
	define TARGET_SPECIFIC_OPTION to enable target specific
	optimization.  Use TARGET_SPECIFIC_* hooks from the back end.
	(driver_pop_options): Ditto.

	* common.opt (falign-functions): Add attribute to option.
	(falign-jumps): Ditto.
	(falign-loops): Ditto.

	* c-common.c (c_common_attribute_table): Add option attribute only
	if backend defines TARGET_SPECIFIC_OPTION.

	* config/i386/i386.h (OVERRIDE_OPTIONS): Add argument to say this
	is the first call.
	(TARGET_SPECIFIC_INIT): Define backend hook.
	(TARGET_SPECIFIC_OPTION): Ditto.
	(TARGET_SPECIFIC_PUSH): Ditto.
	(TARGET_SPECIFIC_POP): Ditto.

	* config/i386/i386-protos.h (ix86_target_specific_option): New
	declaration for target specific option support.
	(ix86_target_specific_init): Ditto.
	(ix86_target_specific_push): Ditto.
	(ix86_target_specific_pop): Ditto.
	(override_option): Take an argument to say whether it is the
	global call or from target specific options.

	* config/i386/i386.c (initial_ix86_tune_features): Move
	initialization here from ix86_tune_features to allow array to be
	set up differently for each function with target specific
	optimization.
	(ix86_tune_features): Ditto.
	(initial_ix86_arch_features): Move initialization here from
	ix86_arch_features to allow to be set up differently for each
	function with target specific optimization.
	(ix86_arch_features): Ditto.
	(ix86_string_ops): New variable to list -m<xxx>= options.
	(ix86_save_string_ops): New structure to allow string opts to be
	saved, restored.
	(ix86_prev_string_ops): Stack of previous string ops.
	(override_options): Move initialization of ix86_tune_features
	here.  Add argument for being called a second time.
	(ix86_target_specific_init): New hook for target specific support.
	(ix86_target_specific_init): Ditto.
	(ix86_target_specific_push): Ditto.
	(ix86_target_specific_pop): Ditto.

2008-05-15  Michael Meissner  <michael.meissner@amd.com>

	* Sync up to 135377.

2008-04-23  Michael Meissner  <michael.meissner@amd.com>

	* tree-pass.h (pass_push_set_options): Switch to rtl_opt_pass.
	(pass_pop_options): Ditto.

	* tree-opt.c (pass_push_set_options): Adjust for switch to
	rtl_opt_pass type.
	(pass_pop_options): Ditto.

2008-04-21  Karthik Kumar  <karthikkumar@gmail.com>

	* [abepstx]mmintrin.h, mm3dnow.h, mmintrin-common.h: Annotated
	intrinsics with their appropriate attributes for checking inlining.

2008-04-11  Karthik Kumar  <karthikkumar@gmail.com>

	* optc-gen.awk: Removed definition of target_flags because of
	usage as a versioned variable.
	* opth-gen.awk: Make versioned macros and versioned aliases for
	option testing and setting.
	* gensupport.c: Remove definition of target_flags.
	* rtlanal.c: Remove definition of target_flags.
	* toplev.c: Remove definition of target_flags_explicit.
	* opts.h: Pushed in cl_option_storp typedef.
	* opts-common.c: Removed cl_option_storp typedef.
	* tree.h: Added field to store options in functions.
	* Makefile.in: Added opts.h as a dependancy for TREE_H

2008-03-11  Michael Meissner  <michael.meissner@amd.com>

	* opts-common.c (cl_option_stors_stack): Fix spacing.
	(cl_option_stors_stack): Ditto.
	(push_attribute_options): Ditto.
	(pop_attribute_options): Ditto.

	* toplev.c (toplev_main): Fix spacing.

	* opts.c (handle_option): Fix spacing.
	(handle_options): Ditto.

	* opts.h (cl_option_stor): Fix spacing.
	(cl_option): Ditto.
	(handle_option): Ditto.

	* c-common.c (handle_option_attribute): Fix spacing.

	* config/i386/i386.c (override_options): Fix spacing.

2008-03-06  Karthik Kumar  <karthikkumar@gmail.com>

	* tree-opt.c (function-specific-branch): Implemented pass_push_set_options
	and pass_pop_options which can handle attribute versioning.
	* passes.c (function-specific-branch): Position pass_push_set_options and
	and pass_pop_options around rest_of_compilation. 
	* tree-pass.h (function-specific-branch): Declare pass_push_set_options
	and pass_pop_options.

2008-01-14  Karthik Kumar  <karthikkumar@gmail.com>

	* c-common.c (function-specific-branch): Implemented attribute handler
	* opts.h (function-specific-branch): Made handle_option public so 
	it can be reused in other code. Modified its signature to enable attribute
	checking.
	* opts.c (function-specific-branch): Modified to implement attribute
	checking.
	* config/i386/i386.c (function-specific-branch): Rewrite parts of 
	override_options.
	* docs/extend.texi (function-specific-branch): Document the 
	implemented attributes.

2008-01-05  Karthik Kumar  <karthikkumar@gmail.com>

	* opts.h (function-specific-branch): Added union to store
	modifiable flags; Changed bool and size_t types to enable
	compilation of libgcc; Added declarations for 
	initialize_attribute_options(), push_attribute_options()
	and pop_attribute_options() and CL_ATTRIBUTE; Changed 
	signedness of masks.
	* opts-common.c (function-specific-branch): Modified to match
	declarations in opts.h; Added push_attribute_options() and
	pop_attribute_options(); Implemented a custom stack.
	* opts.c (function-specific-branch): Modified to match
	declarations in opts.h.
	* toplev.c (function-specific-branch): Make a call to 
	initialize_attribute_options in toplev_main()
	* opt-functions.awk (function-specific-branch): Added var_decl(),
	modified var_type() to remove trailing space to "int"; Modified
	switch_flags to accomodate CL_ATTRIBUTE.
	* optc-gen.awk (function-specific-branch): Modify to use attributes
	and add initialize_attribute_options().
	* opth-gen.awk (function-specific-branch): Modify to use attributes
	and generate #define s for such flags.
	* config/linux.opt (function-specific-branch): Reorder the flags
	to generate only one definition in options.c.
	* config/i386/i386.opt (function-specific-branch): Make all options
	based on ix86_isa_flags use Attribute; Moved ix86_isa_flags
	initialization into this file.
	* config/i386/i386.h (function-specific-branch): Remove extern
	declaration of ix86_isa_flags.
	* config/i386/i386.c (function-specific-branch): Remove declaration of 
	ix86_isa_flags, pushed initialization to i386.opt.
	* docs/options.texi (function-specific-branch): Document the 
	Attribute flag.

2008-01-02  Michael Meissner  <michael.meissner@amd.com>

Merged up to revision 131261 

2007-12-14  Michael Meissner  <michael.meissner@amd.com>

Merged up to revision 130941

2007-12-13  Michael Meissner  <michael.meissner@amd.com>

	* REVISION: New file, "function-specific-branch" to mark this
	branch.

Function specific optimization branch created from revision 130896


